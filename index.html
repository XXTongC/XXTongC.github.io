<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://xxtongc.github.io/project/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/project/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/project/favicon.png">
  
  
  
<link rel="stylesheet" href="/project/css/style.css">

  
    
<link rel="stylesheet" href="/project/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/project/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/project/">Home</a>
        
          <a class="main-nav-link" href="/project/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/project/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://XXTongC.github.io/project"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-设计模式/结构性设计模式/适配器模式(Adapter)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F(Adapter)/" class="article-date">
  <time class="dt-published" datetime="2026-01-23T20:42:35.669Z" itemprop="datePublished">2026-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="适配器模式-Adapter"><a href="#适配器模式-Adapter" class="headerlink" title="适配器模式(Adapter)"></a>适配器模式(Adapter)</h1><p>适配器的概率其实很好理解，它的目的在于允许接口不兼容的对象能够相互协作，经典的实例就是电源适配器，它能够连接不同标准的接口使得它们能够一起工作。</p>
<h2 id="核心组成部分"><a href="#核心组成部分" class="headerlink" title="核心组成部分"></a>核心组成部分</h2><ol>
<li>目标接口（Target）：客户端期望的接口</li>
<li>适配者（Adaptee）：需要被适配的类，具有不兼容的接口</li>
<li>适配器（Adapter）：将适配者的接口转换为目标接口的类</li>
</ol>
<h2 id="两种实现方式"><a href="#两种实现方式" class="headerlink" title="两种实现方式"></a>两种实现方式</h2><ol>
<li>类适配器：使用多重继承（在C++中）实现</li>
<li>对象适配器：使用组合关系实现（更常用）</li>
</ol>
<h2 id="适配器模式的适用场景"><a href="#适配器模式的适用场景" class="headerlink" title="适配器模式的适用场景"></a>适配器模式的适用场景</h2><ol>
<li>使用现有类，但其接口与需求不匹配：例如，需要集成第三方库或遗留代码。</li>
<li>创建可重用的类，与不相关或不可预见的类协同工作：适配器可以使原本不兼容的类一起工作。</li>
<li>需要使用多个现有子类，但不可能对每一个都进行子类化以匹配接口：可以创建适配器来适配它们的父类。</li>
<li>需要统一多个类的接口：当系统中存在多个类具有相似功能但接口不同时。</li>
</ol>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><h3 id="对象适配器"><a href="#对象适配器" class="headerlink" title="对象适配器"></a>对象适配器</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 目标接口 - 客户端期望的接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Target</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Target</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::string <span class="title">request</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 适配者 - 具有不兼容接口的类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Adaptee</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">std::string <span class="title">specificRequest</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Specific request from Adaptee&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 适配器 - 将适配者接口转换为目标接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Adapter</span> : <span class="keyword">public</span> Target &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::shared_ptr&lt;Adaptee&gt; adaptee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Adapter</span>(std::shared_ptr&lt;Adaptee&gt; adaptee) : <span class="built_in">adaptee</span>(adaptee) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string <span class="title">request</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 转换调用</span></span><br><span class="line">        std::string result = adaptee-&gt;<span class="built_in">specificRequest</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Adapter: (TRANSLATED) &quot;</span> + result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">clientCode</span><span class="params">(<span class="type">const</span> Target&amp; target)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; target.<span class="built_in">request</span>() &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体目标实现 - 为了示例完整性</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteTarget</span> : <span class="keyword">public</span> Target &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">std::string <span class="title">request</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ConcreteTarget: Standard request&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 使用原生目标对象</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Client: I can work with Target objects:&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">auto</span> target = std::<span class="built_in">make_unique</span>&lt;ConcreteTarget&gt;();</span><br><span class="line">    <span class="built_in">clientCode</span>(*target);</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用适配者对象 + 适配器</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Client: I can work with Adaptee objects through the Adapter:&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">auto</span> adaptee = std::<span class="built_in">make_shared</span>&lt;Adaptee&gt;();</span><br><span class="line">    <span class="keyword">auto</span> adapter = std::<span class="built_in">make_unique</span>&lt;Adapter&gt;(adaptee);</span><br><span class="line">    <span class="built_in">clientCode</span>(*adapter);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="类适配器"><a href="#类适配器" class="headerlink" title="类适配器"></a>类适配器</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 目标接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Target</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Target</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::string <span class="title">request</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 适配者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Adaptee</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">std::string <span class="title">specificRequest</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Specific request from Adaptee&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类适配器 - 使用多重继承</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassAdapter</span> : <span class="keyword">public</span> Target, <span class="keyword">private</span> Adaptee &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">std::string <span class="title">request</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 直接调用父类方法</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ClassAdapter: (TRANSLATED) &quot;</span> + <span class="built_in">specificRequest</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">clientCode</span><span class="params">(<span class="type">const</span> Target&amp; target)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; target.<span class="built_in">request</span>() &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Client: Using ClassAdapter:&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    ClassAdapter adapter;</span><br><span class="line">    <span class="built_in">clientCode</span>(adapter);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://xxtongc.github.io/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F(Adapter)/" data-id="cmkrcm9v50009noul06drc7a7" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-设计模式/结构性设计模式/装饰器模式(Decorator)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F(Decorator)/" class="article-date">
  <time class="dt-published" datetime="2026-01-23T20:42:35.666Z" itemprop="datePublished">2026-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="装饰器模式-Decorator"><a href="#装饰器模式-Decorator" class="headerlink" title="装饰器模式(Decorator)"></a>装饰器模式(Decorator)</h1><p>通常情况下需要扩展一个类的时候我们会想到继承：设计一个派生类添加想要的功能，甚至覆写父类的虚函数。</p>
<p>但这并不总是最有效的方法，例如我们很少去继承 std::vector ，因为其缺少虚析构函数。继承不起作用的关键原因是我们需要实现多个强化的功能，并且由于单一职责原则，我们希望将这些功能分开。</p>
<p>此时装饰器(Decorator)模式允许我们在既不修改原始类型（违背开闭原则）也不会产生大量派生类的情况下强化既有类型的职责和功能。</p>
<h2 id="装饰器模式的典型结构"><a href="#装饰器模式的典型结构" class="headerlink" title="装饰器模式的典型结构"></a>装饰器模式的典型结构</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">┌─────────────────┐</span><br><span class="line">│   Component     │ (抽象组件接口)</span><br><span class="line">│  &lt;&lt;interface&gt;&gt;  │</span><br><span class="line">├─────────────────┤</span><br><span class="line">│ + operation()   │</span><br><span class="line">└────────▲────────┘</span><br><span class="line">         │</span><br><span class="line">         │ 实现</span><br><span class="line">    ┌────┴────────────────────┐</span><br><span class="line">    │                         │</span><br><span class="line">┌───┴──────────────┐  ┌───────┴────────┐</span><br><span class="line">│ConcreteComponent │  │   Decorator    │ (装饰器基类)</span><br><span class="line">├──────────────────┤  ├────────────────┤</span><br><span class="line">│+ operation()     │  │- component     │ (持有Component引用)</span><br><span class="line">└──────────────────┘  │+ operation()   │</span><br><span class="line">                      └───────▲────────┘</span><br><span class="line">                              │</span><br><span class="line">                              │ 继承</span><br><span class="line">                    ┌─────────┴──────────┐</span><br><span class="line">                    │                    │</span><br><span class="line">            ┌───────┴─────────┐  ┌───────┴─────────┐</span><br><span class="line">            │DecoratorA       │  │DecoratorB       │</span><br><span class="line">            ├─────────────────┤  ├─────────────────┤</span><br><span class="line">            │+ operation()    │  │+ operation()    │</span><br><span class="line">            │+ addedBehavior()│  │+ addedBehavior()│</span><br><span class="line">            └─────────────────┘  └─────────────────┘</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>角色</th>
<th>职责</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Component</strong></td>
<td>抽象组件</td>
<td>定义对象接口，可以给这些对象动态添加职责</td>
</tr>
<tr>
<td><strong>ConcreteComponent</strong></td>
<td>具体组件</td>
<td>定义具体对象，装饰器可以给它添加额外职责</td>
</tr>
<tr>
<td><strong>Decorator</strong></td>
<td>抽象装饰器</td>
<td>持有一个Component对象，并实现Component接口</td>
</tr>
<tr>
<td><strong>ConcreteDecorator</strong></td>
<td>具体装饰器</td>
<td>向组件添加具体职责</td>
</tr>
</tbody></table>
<p>其工作流程大致如下：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">客户端请求 → ConcreteDecoratorB → ConcreteDecoratorA → ConcreteComponent</span><br><span class="line">                    ↓                      ↓                    ↓</span><br><span class="line">                添加功能B              添加功能A            核心功能</span><br><span class="line">                    ↓                      ↓                    ↓</span><br><span class="line">                    ←──────────────────────←────────────────────</span><br><span class="line">                              返回结果（层层包装）</span><br></pre></td></tr></table></figure>

<p>装饰器模式一般有两种实现模式：</p>
<ul>
<li><strong>动态组合</strong> 允许在运行时组合某些东西，通常是通过按引用传递实现的。它的灵活性强，因为组合可以在运行时相应用户的输入。</li>
<li><strong>静态组合</strong> 意味着对象及其强化功能是在编译期时使用模板组合而成的。这意味着在编译时需要知道对象确切的强化功能，因为之后无法对其进行修改。</li>
</ul>
<h2 id="动态装饰器"><a href="#动态装饰器" class="headerlink" title="动态装饰器"></a>动态装饰器</h2><p>考虑为一个 Shape 类扩展关于颜色的功能。使用组合而不是继承实现 Colored-Shape，传入一个 Shape 的引用，这时候 ColoredShape 就可以在已构造好的 Shape 上强化其功能：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Shape</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::string <span class="title">str</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Circle</span> : Shape</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">float</span> radius;</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Circle</span><span class="params">(<span class="type">const</span> <span class="type">float</span> radius)</span></span></span><br><span class="line"><span class="function">	    :radius(radius)</span></span><br><span class="line"><span class="function">    &#123;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">resize</span><span class="params">(<span class="type">float</span> factor)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        radius *= factor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string <span class="title">str</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::ostringstream oss;</span><br><span class="line">        oss &lt;&lt; <span class="string">&quot;A circle of radius &quot;</span> &lt;&lt; radius;</span><br><span class="line">        <span class="keyword">return</span> oss.<span class="built_in">str</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ColoredShape</span> : Shape</span><br><span class="line">&#123;</span><br><span class="line">    Shape&amp; shape;</span><br><span class="line">    std::string color;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ColoredShape</span>(Shape&amp; shape,<span class="type">const</span> std::string&amp; color)</span><br><span class="line">	    :<span class="built_in">shape</span>(shape),<span class="built_in">color</span>(color)</span><br><span class="line">	&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string <span class="title">str</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::ostringstream oss;</span><br><span class="line">        oss &lt;&lt; shape.<span class="built_in">str</span>() &lt;&lt; <span class="string">&quot; has the color &quot;</span> &lt;&lt; <span class="keyword">this</span>-&gt;color;</span><br><span class="line">        <span class="keyword">return</span> oss.<span class="built_in">str</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">make_dark</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">constexpr</span> <span class="keyword">auto</span> dark = <span class="string">&quot;dark &quot;</span>; !color.<span class="built_in">starts_with</span>(dark))</span><br><span class="line">            color.<span class="built_in">insert</span>(<span class="number">0</span>, dark);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>可以发现，ColoredShape 本身也是一个 Shape，同时组合了一个它装饰的 Shape 的引用。其中 constexpr、if 初始化和 运用C++20的 starts_with() 去创建了一个成员函数 make_dark()。</p>
<p>此时可以如下使用这个装饰器：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Circle circle&#123; <span class="number">0.5f</span> &#125;;</span><br><span class="line">ColoredShape redCircle&#123; circle,<span class="string">&quot;red&quot;</span> &#125;;</span><br><span class="line">std::cout &lt;&lt; redCircle.<span class="built_in">str</span>()&lt;&lt;std::endl;</span><br><span class="line"><span class="comment">// A circle of radius 0.5 has the color red</span></span><br><span class="line">redCircle.<span class="built_in">make_dark</span>();</span><br><span class="line">std::cout &lt;&lt; redCircle.<span class="built_in">str</span>() &lt;&lt; std::endl;</span><br><span class="line"><span class="comment">// A circle of radius 0.5 has the color dark red</span></span><br></pre></td></tr></table></figure>

<p>此时我们想要给 Shape 增加一个透明度的强化功能，那么如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TransparentShape</span> : Shape</span><br><span class="line">&#123;</span><br><span class="line">    Shape&amp; shape;</span><br><span class="line">    <span class="type">uint8_t</span> transparency;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">TransparentShape</span>(Shape&amp; shape,<span class="type">const</span> <span class="type">uint8_t</span> transparency)</span><br><span class="line">	    :<span class="built_in">shape</span>(shape),<span class="built_in">transparency</span>(transparency)</span><br><span class="line">	&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string <span class="title">str</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::ostringstream oss;</span><br><span class="line">        oss &lt;&lt; shape.<span class="built_in">str</span>() &lt;&lt; <span class="string">&quot; has &quot;</span> &lt;&lt; <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(transparency) / <span class="number">255.f</span> * <span class="number">100.f</span> &lt;&lt; <span class="string">&quot;% transparency&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> oss.<span class="built_in">str</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>此时根据我们组合模式的原理，我们可以设计如下同时具有透明度和颜色属性的圆形：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Circle c&#123; <span class="number">5</span> &#125;;</span><br><span class="line">ColoredShape cs&#123; c,<span class="string">&quot;green&quot;</span> &#125;;</span><br><span class="line">TransparentShape myCircle&#123; cs,<span class="number">64</span> &#125;;</span><br><span class="line">std::cout &lt;&lt; myCircle.<span class="built_in">str</span>();</span><br><span class="line"><span class="comment">// A circle of radius 5 has the color green has 25.098% transparency</span></span><br></pre></td></tr></table></figure>

<p>但是如此写是需要修改代码的：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TransparentShape t&#123;ColoredShape&#123;Circle&#123;<span class="number">23</span>&#125;,<span class="string">&quot;green&quot;</span>&#125;,<span class="number">64</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>这里是编译器是会报错的（当然这取决于编译器），因为我们这里并不能将临时对象传给一个引用，这会造成悬空。</p>
<h2 id="静态装饰器"><a href="#静态装饰器" class="headerlink" title="静态装饰器"></a>静态装饰器</h2><p>在上面创建的示例中有一个很有趣的地方，可以试试去调用一下 Circle 中的 resize()。</p>
<p>实际上 resize() 并不是 Shape 接口的一部分，我们并不能在装饰器中调用它。但是如果我们想要访问被装饰对象的属性成员和成员函数，我们可以通过模板，使用 mixin 继承的方式也就是类继承自它的模板参数来实现：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">template&lt;typename T&gt;</span></span><br><span class="line"><span class="comment">concept ShapeConcept = requires(const T t) &#123;</span></span><br><span class="line"><span class="comment">    &#123; t.str() &#125; -&gt; std::convertible_to&lt;std::string&gt;;</span></span><br><span class="line"><span class="comment">&#125; &amp;&amp; std::is_base_of_v&lt;Shape, T&gt;;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ColoredShape</span> : T</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">static_assert</span>(std::is_base_of_v&lt;Shape, T&gt;, <span class="string">&quot;Template argument must be a Shape&quot;</span>);</span><br><span class="line"></span><br><span class="line">	std::string color;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ColoredShape</span>(<span class="type">const</span> std::string&amp; color)</span><br><span class="line">	    :<span class="built_in">color</span>(color)</span><br><span class="line">	&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string <span class="title">str</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::ostringstream oss;</span><br><span class="line">        oss &lt;&lt; T::<span class="built_in">str</span>() &lt;&lt; <span class="string">&quot; has the color &quot;</span> &lt;&lt; color;</span><br><span class="line">        <span class="keyword">return</span> oss.<span class="built_in">str</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">make_dark</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">constexpr</span> <span class="keyword">auto</span> dark = <span class="string">&quot;dark&quot;</span>; !color.<span class="built_in">starts_with</span>(dark))</span><br><span class="line">            color.<span class="built_in">insert</span>(<span class="number">0</span>, dark);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TransparentShape</span> : T</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">static_assert</span>(std::is_base_of_v&lt;Shape, T&gt;, <span class="string">&quot;Template argument must be a Shape&quot;</span>);</span><br><span class="line">    <span class="type">uint8_t</span> transparency;</span><br><span class="line">    <span class="built_in">TransparentShape</span>()&#123;&#125;;</span><br><span class="line">    <span class="built_in">TransparentShape</span>(<span class="type">const</span> <span class="type">uint8_t</span> transparency)</span><br><span class="line">	    :<span class="built_in">transparency</span>(transparency)</span><br><span class="line">	&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string <span class="title">str</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::ostringstream oss;</span><br><span class="line">        oss &lt;&lt; T::<span class="built_in">str</span>() &lt;&lt; <span class="string">&quot; has &quot;</span> &lt;&lt; <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(transparency) / <span class="number">255.f</span> * <span class="number">100.f</span> &lt;&lt; <span class="string">&quot;% transparency&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> oss.<span class="built_in">str</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>我们通过让类继承其模板参数，使其一一具备了我们需要的模板的成员函数和成员变量，同时可以通过 static_assert 或 concept-require 语句去约束模板参数，来保证 T 继承自 Shape</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ColoredShape&lt;TransparentShape&lt;Circle&gt;&gt; circle&#123; <span class="string">&quot;green&quot;</span> &#125;;</span><br><span class="line">circle.radius = <span class="number">2</span>;</span><br><span class="line">circle.transparency = <span class="number">0.5</span>;</span><br><span class="line">std::cout &lt;&lt; circle.<span class="built_in">str</span>()&lt;&lt;std::endl;</span><br><span class="line"><span class="comment">// A circle of radius 2 has 0% transparency has the color green</span></span><br><span class="line">circle.<span class="built_in">resize</span>(<span class="number">2</span>);</span><br><span class="line">std::cout &lt;&lt; circle.<span class="built_in">str</span>();</span><br><span class="line"><span class="comment">// A circle of radius 4 has 0% transparency has the color green</span></span><br></pre></td></tr></table></figure>

<p>但是这样的方法也有缺点，我们并没有充分利用构造函数，使得我们只能初始化最外层的类，不能够一行代码就完成这个类的实现。</p>
<p>为了实现这个功能，我们需要构建两者的转发构造函数。这些构造函数将接受两个参数：第一个是特定于当前模板类的参数，第二个是将转发给基类的通用参数包：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> ...Args&gt;</span></span><br><span class="line"><span class="function"><span class="title">TransparentShape</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span> transparency,Args... args)</span></span></span><br><span class="line"><span class="function">    :T(std::forward&lt;Args&gt;(args)...),transparency(transparency)</span></span><br><span class="line"><span class="function">&#123;</span>&#125;</span><br><span class="line"><span class="comment">// same for ColoredShape</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是初始化的顺序，我们需要先为 T 的构造函数转发参数包，并且需要注意构造函数参数的数量必须准确，否则会因为无法匹配而编译失败。</p>
<p>还有一个问题是不能将这些构造函数声明为显式的（explicite），否则当多个装饰器组合起来后将会被C++的复制列表初始化规则困扰。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://xxtongc.github.io/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F(Decorator)/" data-id="cmkrcm9v40008noul673f4pqx" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-设计模式/结构性设计模式/组合模式" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time class="dt-published" datetime="2026-01-23T20:42:35.664Z" itemprop="datePublished">2026-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h1><p>组合模式的核心思想如下：</p>
<ol>
<li>统一单个对象和组合对象的处理方式：让客户端可以以相同的方式处理单个对象（叶节点）和组合对象（容器节点）。</li>
<li>树形结构：允许将对象组合成树形结构来表示”部分-整体”的层次关系。</li>
<li>递归组合：组合中的对象可以是单个对象，也可以是组合对象。</li>
</ol>
<p>其典型结构如下：</p>
<ol>
<li>组件（Component）：为所有对象定义统一接口</li>
<li>叶节点（Leaf）：表示单个对象，没有子节点</li>
<li>组合节点（Composite）：包含子节点的组件</li>
</ol>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Neuron</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基类模板，使用CRTP模式</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Self&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SomeNeuron</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">connect_to</span><span class="params">(T&amp; other)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Neuron&amp; from : *<span class="built_in">static_cast</span>&lt;Self*&gt;(<span class="keyword">this</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (Neuron&amp; to : other)</span><br><span class="line">            &#123;</span><br><span class="line">                from.out.<span class="built_in">push_back</span>(&amp;to);</span><br><span class="line">                to.in.<span class="built_in">push_back</span>(&amp;from);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 神经元类</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Neuron</span> : <span class="keyword">public</span> SomeNeuron&lt;Neuron&gt;</span><br><span class="line">&#123;</span><br><span class="line">    std::vector&lt;Neuron*&gt; in, out;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Neuron</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> id = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">this</span>-&gt;id = id++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 让Neuron可迭代，实现begin()和end()</span></span><br><span class="line">    <span class="function">Neuron* <span class="title">begin</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>; &#125;</span><br><span class="line">    <span class="function">Neuron* <span class="title">end</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span> + <span class="number">1</span>; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 打印神经元信息的函数</span></span><br><span class="line">    <span class="keyword">friend</span> std::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(std::ostream&amp; os, <span class="type">const</span> Neuron&amp; obj)</span><br><span class="line">    &#123;</span><br><span class="line">        os &lt;&lt; <span class="string">&quot;Neuron &quot;</span> &lt;&lt; obj.id &lt;&lt; std::endl;</span><br><span class="line">        os &lt;&lt; <span class="string">&quot;  Connections from: &quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (Neuron* n : obj.in)</span><br><span class="line">            os &lt;&lt; n-&gt;id &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        os &lt;&lt; std::endl;</span><br><span class="line">        </span><br><span class="line">        os &lt;&lt; <span class="string">&quot;  Connections to: &quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (Neuron* n : obj.out)</span><br><span class="line">            os &lt;&lt; n-&gt;id &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        os &lt;&lt; std::endl;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> os;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 神经元层，继承自vector&lt;Neuron&gt;</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NeuronLayer</span> : std::vector&lt;Neuron&gt;, SomeNeuron&lt;NeuronLayer&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NeuronLayer</span>(<span class="type">int</span> count)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> (count-- &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">emplace_back</span>(Neuron&#123;&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">friend</span> std::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(std::ostream&amp; os, <span class="type">const</span> NeuronLayer&amp; obj)</span><br><span class="line">    &#123;</span><br><span class="line">        os &lt;&lt; <span class="string">&quot;Layer with &quot;</span> &lt;&lt; obj.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot; neurons&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> os;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这段代码有很多有趣的地方，首先我们的层次结构由神经元（Neuron）为标量组成，神经层（NeuronLayer）由多个神经元组成。</p>
<p>然后我们需要对神经元之间连接的函数，首先可以想到有 神经元&lt;—&gt;神经元，或者 神经元&lt;—&gt;神经层，也可 神经层&lt;—&gt;神经层 之间相连接。</p>
<p>这里使用组合模式的方法去设计 connect_to ，也就是在这段代码中 SomeNeuron 是之前所述中的<strong>组件</strong>，Neuron作为<strong>叶节点</strong>，NeuronLayer就是<strong>组合节点</strong>。</p>
<p>其设计模式的目的就是让用户能用相同的接口处理单个对象和对象组合，而不需要单独为两者或两者之间单独编写代码。</p>
<hr>
<p>这里需要单独解释一下SomeNeuron的设计，这是一个有趣的设计不是吗：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基类模板，使用CRTP模式</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Self&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SomeNeuron</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">connect_to</span><span class="params">(T&amp; other)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Neuron&amp; from : *<span class="built_in">static_cast</span>&lt;Self*&gt;(<span class="keyword">this</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (Neuron&amp; to : other)</span><br><span class="line">            &#123;</span><br><span class="line">                from.out.<span class="built_in">push_back</span>(&amp;to);</span><br><span class="line">                to.in.<span class="built_in">push_back</span>(&amp;from);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>CRTP：Curiously Recurring Template Pattern 也称奇异递归模板模式，特点在于继承自 将派生类自身作为模板参数 的基类，其基本形式如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Derived&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line">    <span class="comment">// 基类可以使用Derived类的方法或属性</span></span><br><span class="line">    <span class="comment">// 通过static_cast&lt;Derived*&gt;(this)</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base&lt;Derived&gt; &#123;</span><br><span class="line">    <span class="comment">// 派生类的实现</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>它的目的在于让基类获得访问其派生类的特性，在编译期就决定了正确的函数调用，实现的是静态多态。</p>
<p>在我们的代码中，如此书写可以让</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Neuron&amp; from : *<span class="built_in">static_cast</span>&lt;Self*&gt;(<span class="keyword">this</span>))</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在第一层循环中将 基类 转化为 派生类从而正确地调用相应的迭代函数。如此在后续如果要添加其他种类的神经组合类如：NeuronRing，那么我们也只需要设计对应的迭代函数 begin()&#x2F;end() 就可以在不修改 connect_to 的情况下完成连接。这就十分符合我们的开闭原则，不会对已经实现的功能做任何修改就可以进行扩展。</p>
<h2 id="封装组合模式"><a href="#封装组合模式" class="headerlink" title="封装组合模式"></a>封装组合模式</h2><p>在上述代码中我们并没有强制告诉用户其实我们需要为标量实现begin()&#x2F;end()，那么我们可以将这个功能进行进一步封装。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Scalar</span> : <span class="keyword">public</span> SomeNeurons&lt;T&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">T* <span class="title">begin</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">reinterpret_cast</span>&lt;T*&gt;(<span class="keyword">this</span>); &#125;</span><br><span class="line">    <span class="function">T* <span class="title">end</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">reinterpret_cast</span>&lt;T*&gt;(<span class="keyword">this</span>) + <span class="number">1</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Neuron</span> : <span class="keyword">public</span> Scalar&lt;Neuron&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// as before</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="C-20-concept"><a href="#C-20-concept" class="headerlink" title="C++20 concept"></a>C++20 concept</h2><p>C++20 更新了 concep 语义，让我们试试看能不能应用到这个示例上。</p>
<p>因为 connect_to 函数运用了迭代器，所以我们必须给 SomeNeuron 的对象派生类实现 begin()&#x2F;end()。可以运用 C++20 的语义对这个条件进行模板参数的限制：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">concept</span> Iterable = <span class="built_in">requires</span>(T&amp; t)</span><br><span class="line">&#123;</span><br><span class="line">    t.<span class="built_in">begin</span>();</span><br><span class="line">    t.<span class="built_in">end</span>();</span><br><span class="line">&#125; || <span class="built_in">requires</span>(T&amp; t)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">begin</span>(t);</span><br><span class="line">    <span class="built_in">end</span>(t);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>看起来不错对吧，这样就能写如下的代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;Iterable Self&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SomeNeurons</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;Iterable T&gt;</span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">connect_to</span><span class="params">(T&amp; other)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// as before</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>但是物体来了，模板函数那里的Iterable是可以实现的，但是将 Self 声明为 Iterable 却会出现问题。</p>
<p>考虑之前定义的 Scalar 类，它继承自 SomeNeurons&lt; T &gt; 所以我们需要将 T 约束为可迭代的：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;Iterable T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Scalar</span> : <span class="keyword">public</span> SomeNeurons&lt;T&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// as before</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>但是这样的方法不能让我们定义 Neuron 类：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Neuron</span> : Scalar&lt;Neuron&gt;</span><br></pre></td></tr></table></figure>

<p>按要求我们需要 Neuron 本身具备迭代能力，但事实上它是通过继承 Scalar 获得的迭代能力。Neuron 类需要先继承 Scalar&lt; Neuron &gt; 才能满足 Iterable 概念，但 Scalar&lt; Neuron &gt; 的基类 SomeNeurons&lt; Neuron &gt; 又要求 Neuron 已经满足 Iterable 概念，这形成了无法解决的循环依赖。</p>
<p>可能基于 concept 的 CRTP 确实是不可能实现的吧。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://xxtongc.github.io/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/" data-id="cmkrcm9v40007nouleafc63qv" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-设计模式/结构性设计模式/第一阶段：适配器模式、桥接模式、装饰器模式和观察者模式对比" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%EF%BC%9A%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E3%80%81%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F%E3%80%81%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E5%92%8C%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E5%AF%B9%E6%AF%94/" class="article-date">
  <time class="dt-published" datetime="2026-01-23T20:42:35.661Z" itemprop="datePublished">2026-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="第一阶段：适配器模式、桥接模式、装饰器模式和观察者模式对比"><a href="#第一阶段：适配器模式、桥接模式、装饰器模式和观察者模式对比" class="headerlink" title="第一阶段：适配器模式、桥接模式、装饰器模式和观察者模式对比"></a>第一阶段：适配器模式、桥接模式、装饰器模式和观察者模式对比</h1><h2 id="一核心思想对比"><a href="#一核心思想对比" class="headerlink" title="一核心思想对比"></a>一核心思想对比</h2><table>
<thead>
<tr>
<th>模式</th>
<th>核心思想</th>
<th>关键词</th>
</tr>
</thead>
<tbody><tr>
<td><strong>桥接模式 (Bridge)</strong></td>
<td>将抽象与实现分离，使两者可以独立变化</td>
<td>分离、解耦、两个维度</td>
</tr>
<tr>
<td><strong>适配器模式 (Adapter)</strong></td>
<td>将一个类的接口转换成客户期望的另一个接口</td>
<td>转换、兼容、包装</td>
</tr>
<tr>
<td><strong>装饰器模式 (Decorator)</strong></td>
<td>动态地给对象添加额外的职责</td>
<td>增强、扩展、递归包装</td>
</tr>
<tr>
<td><strong>组合模式 (Composite)</strong></td>
<td>将对象组合成树形结构，统一处理单个对象和组合对象</td>
<td>树形、部分-整体、递归</td>
</tr>
</tbody></table>
<h2 id="基本结构对比"><a href="#基本结构对比" class="headerlink" title="基本结构对比"></a>基本结构对比</h2><h3 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Abstraction ──组合──&gt; Implementor</span><br><span class="line">     ↑                      ↑</span><br><span class="line">RefinedAbstraction   ConcreteImplementor</span><br><span class="line"></span><br><span class="line">特点：两个独立的继承层次，通过组合连接</span><br></pre></td></tr></table></figure>

<h3 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Client ──&gt; Target</span><br><span class="line">             ↑</span><br><span class="line">          Adapter ──组合/继承──&gt; Adaptee</span><br><span class="line"></span><br><span class="line">特点：单层包装，转换接口</span><br></pre></td></tr></table></figure>

<h3 id="装饰器模式"><a href="#装饰器模式" class="headerlink" title="装饰器模式"></a>装饰器模式</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Component</span><br><span class="line">     ↑</span><br><span class="line">     ├─── ConcreteComponent</span><br><span class="line">     └─── Decorator ──组合──&gt; Component</span><br><span class="line">               ↑</span><br><span class="line">        ConcreteDecorator</span><br><span class="line"></span><br><span class="line">特点：装饰器和被装饰对象实现相同接口，可递归嵌套</span><br></pre></td></tr></table></figure>

<h3 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Component</span><br><span class="line">     ↑</span><br><span class="line">     ├─── Leaf</span><br><span class="line">     └─── Composite ──组合──&gt; Component (多个)</span><br><span class="line"></span><br><span class="line">特点：树形结构，组合节点包含多个子节点</span><br></pre></td></tr></table></figure>

<h2 id="何时使用"><a href="#何时使用" class="headerlink" title="何时使用"></a>何时使用</h2><h3 id="桥接模式-1"><a href="#桥接模式-1" class="headerlink" title="桥接模式"></a>桥接模式</h3><ul>
<li>有多个维度的变化（如：形状×颜色）</li>
<li>避免继承导致的类爆炸</li>
<li>需要在运行时切换实现</li>
<li>抽象和实现都需要独立扩展</li>
</ul>
<h3 id="适配器模式-1"><a href="#适配器模式-1" class="headerlink" title="适配器模式"></a>适配器模式</h3><ul>
<li>需要使用现有类，但接口不符合需求</li>
<li>集成第三方库或遗留代码</li>
<li>让不相关的类协同工作</li>
<li>统一多个类的接口</li>
</ul>
<h3 id="装饰器模式-1"><a href="#装饰器模式-1" class="headerlink" title="装饰器模式"></a>装饰器模式</h3><ul>
<li>需要动态添加功能</li>
<li>需要多种功能的任意组合</li>
<li>不能通过继承扩展（如类是final的）</li>
<li>避免子类爆炸</li>
</ul>
<h3 id="组合模式-1"><a href="#组合模式-1" class="headerlink" title="组合模式"></a>组合模式</h3><ul>
<li>需要表示对象的部分-整体层次结构</li>
<li>希望统一处理单个对象和组合对象</li>
<li>需要树形结构（如文件系统、组织架构）</li>
<li>客户端不需要区分叶节点和组合节点</li>
</ul>
<h2 id="典型应用场景"><a href="#典型应用场景" class="headerlink" title="典型应用场景"></a>典型应用场景</h2><table>
<thead>
<tr>
<th>模式</th>
<th>典型场景</th>
</tr>
</thead>
<tbody><tr>
<td><strong>桥接模式</strong></td>
<td>• 图形系统（形状 × 渲染引擎）<br>• 跨平台应用（业务逻辑 × 平台API）<br>• 数据库驱动（数据库 × 驱动类型）<br>• 消息系统（消息类型 × 发送方式）</td>
</tr>
<tr>
<td><strong>适配器模式</strong></td>
<td>• 电源适配器（不同电压标准）<br>• 数据格式转换（XML ↔ JSON）<br>• 单位转换（摄氏度 ↔ 华氏度）<br>• 旧系统集成（Legacy API → Modern Interface）</td>
</tr>
<tr>
<td><strong>装饰器模式</strong></td>
<td>• Java I&#x2F;O流（BufferedReader, InputStreamReader）<br>• 咖啡配料（Coffee + Milk + Sugar）<br>• UI组件（Window + Border + Scrollbar）<br>• 文本格式（Text + Bold + Italic）</td>
</tr>
<tr>
<td><strong>组合模式</strong></td>
<td>• 文件系统（File&#x2F;Directory）<br>• 图形编辑器（Shape&#x2F;Group）<br>• 组织架构（Employee&#x2F;Department）<br>• UI组件树（Widget&#x2F;Container）</td>
</tr>
</tbody></table>
<h2 id="优缺点总结"><a href="#优缺点总结" class="headerlink" title="优缺点总结"></a>优缺点总结</h2><table>
<thead>
<tr>
<th>模式</th>
<th>主要优点</th>
<th>主要缺点</th>
</tr>
</thead>
<tbody><tr>
<td><strong>桥接模式</strong></td>
<td>• 分离抽象和实现<br>• 避免类爆炸<br>• 提高可扩展性</td>
<td>• 增加系统复杂度<br>• 需要正确识别两个维度<br>• 简单场景可能过度设计</td>
</tr>
<tr>
<td><strong>适配器模式</strong></td>
<td>• 提高类复用性<br>• 让不兼容接口协作<br>• 符合开闭原则</td>
<td>• 增加系统复杂度<br>• 过多使用会使系统凌乱<br>• 有额外的间接调用开销</td>
</tr>
<tr>
<td><strong>装饰器模式</strong></td>
<td>• 比继承更灵活<br>• 动态添加功能<br>• 可任意组合</td>
<td>• 多层装饰难以调试<br>• 产生很多小对象<br>• 访问具体类型成员困难</td>
</tr>
<tr>
<td><strong>组合模式</strong></td>
<td>• 统一处理对象<br>• 简化客户端代码<br>• 易于添加新组件</td>
<td>• 难以限制组件类型<br>• 设计过于通用<br>• 递归调用可能影响性能</td>
</tr>
</tbody></table>
<h2 id="特征代码识别"><a href="#特征代码识别" class="headerlink" title="特征代码识别"></a>特征代码识别</h2><h3 id="桥接模式-2"><a href="#桥接模式-2" class="headerlink" title="桥接模式"></a>桥接模式</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Abstraction</span> &#123;</span><br><span class="line">    std::shared_ptr&lt;Implementor&gt; impl;  <span class="comment">// ← 关键特征</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123; impl-&gt;<span class="built_in">operationImpl</span>(); &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="适配器模式-2"><a href="#适配器模式-2" class="headerlink" title="适配器模式"></a>适配器模式</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Adapter</span> : <span class="keyword">public</span> Target &#123;</span><br><span class="line">    std::shared_ptr&lt;Adaptee&gt; adaptee;   <span class="comment">// ← 关键特征</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">request</span><span class="params">()</span> </span>&#123; adaptee-&gt;<span class="built_in">specificRequest</span>(); &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="装饰器模式-2"><a href="#装饰器模式-2" class="headerlink" title="装饰器模式"></a>装饰器模式</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Decorator</span> : <span class="keyword">public</span> Component &#123;</span><br><span class="line">    std::unique_ptr&lt;Component&gt; component; <span class="comment">// ← 关键特征</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123; component-&gt;<span class="built_in">operation</span>(); &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="组合模式-2"><a href="#组合模式-2" class="headerlink" title="组合模式"></a>组合模式</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Composite</span> : <span class="keyword">public</span> Component &#123;</span><br><span class="line">    std::vector&lt;Component*&gt; children;   <span class="comment">// ← 关键特征</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> c : children) c-&gt;<span class="built_in">operation</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://xxtongc.github.io/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%EF%BC%9A%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E3%80%81%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F%E3%80%81%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E5%92%8C%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E5%AF%B9%E6%AF%94/" data-id="cmkrcm9v40006nould3v65nmo" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-设计模式/结构性设计模式/桥接模式" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time class="dt-published" datetime="2026-01-23T20:42:35.658Z" itemprop="datePublished">2026-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h1><p>桥接模式是一种结构型设计模式，它的核心思想是将抽象部分与实现部分分离，使它们可以独立变化。桥接模式将抽象与实现解耦，使两者可以独立地变化。它通过组合而非继承来实现这种解耦。</p>
<p>核心组成部分如下：</p>
<ol>
<li>抽象（Abstraction）：定义抽象类的接口</li>
<li>精确抽象（Refined Abstraction）：扩展抽象类的接口</li>
<li>实现（Implementor）：定义实现类的接口</li>
<li>具体实现（Concrete Implementor）：实现实现类接口的具体类</li>
</ol>
<h2 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h2><ol>
<li>需要避免抽象和实现的永久绑定：例如，一个图形系统需要支持多种渲染引擎。</li>
<li>抽象和实现都需要通过子类扩展：例如，不同形状（圆形、方形）和不同颜色（红色、蓝色）的组合。</li>
<li>实现的变化不应该影响客户端：客户端代码只依赖于抽象接口。</li>
<li>需要在运行时切换实现：例如，在不同平台上使用不同的API实现。</li>
<li>有多个维度的变化：当系统有多个正交的变化维度时，使用桥接模式比使用继承更合适。</li>
</ol>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现部分的接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Implementor</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Implementor</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">operationImpl</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体实现A</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteImplementorA</span> : <span class="keyword">public</span> Implementor &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">operationImpl</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ConcreteImplementorA operation&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体实现B</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteImplementorB</span> : <span class="keyword">public</span> Implementor &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">operationImpl</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ConcreteImplementorB operation&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象部分</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Abstraction</span> &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    std::shared_ptr&lt;Implementor&gt; implementor;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Abstraction</span>(std::shared_ptr&lt;Implementor&gt; impl) : <span class="built_in">implementor</span>(impl) &#123;&#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Abstraction</span>() = <span class="keyword">default</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">operation</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Abstraction: &quot;</span>;</span><br><span class="line">        implementor-&gt;<span class="built_in">operationImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 精确抽象</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RefinedAbstraction</span> : <span class="keyword">public</span> Abstraction &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">RefinedAbstraction</span>(std::shared_ptr&lt;Implementor&gt; impl) : <span class="built_in">Abstraction</span>(impl) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">operation</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;RefinedAbstraction: &quot;</span>;</span><br><span class="line">        implementor-&gt;<span class="built_in">operationImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 扩展的方法</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">additionalOperation</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Additional operation in RefinedAbstraction&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        implementor-&gt;<span class="built_in">operationImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建实现</span></span><br><span class="line">    <span class="keyword">auto</span> implA = std::<span class="built_in">make_shared</span>&lt;ConcreteImplementorA&gt;();</span><br><span class="line">    <span class="keyword">auto</span> implB = std::<span class="built_in">make_shared</span>&lt;ConcreteImplementorB&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建抽象</span></span><br><span class="line">    <span class="function">Abstraction <span class="title">abstraction</span><span class="params">(implA)</span></span>;</span><br><span class="line">    abstraction.<span class="built_in">operation</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建精确抽象，使用不同的实现</span></span><br><span class="line">    <span class="function">RefinedAbstraction <span class="title">refinedAbstraction</span><span class="params">(implB)</span></span>;</span><br><span class="line">    refinedAbstraction.<span class="built_in">operation</span>();</span><br><span class="line">    refinedAbstraction.<span class="built_in">additionalOperation</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 动态切换实现</span></span><br><span class="line">    refinedAbstraction = <span class="built_in">RefinedAbstraction</span>(implA);</span><br><span class="line">    refinedAbstraction.<span class="built_in">operation</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/./pics/%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F%E5%9B%BE%E7%A4%BA.png" alt="图示"></p>
<p>观察抽象部分，其使用组合的方法获得接口的声明，通过传入具体实现从而实现动态多态调用。抽象接口的使用允许组件之间在不了解具体实现的情况下彼此交互。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://xxtongc.github.io/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/" data-id="cmkrcm9v30005noul6k72102e" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-设计模式/结构性设计模式/外观模式(Façade)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F(Fa%C3%A7ade)/" class="article-date">
  <time class="dt-published" datetime="2026-01-23T20:42:35.655Z" itemprop="datePublished">2026-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="外观模式-Facade"><a href="#外观模式-Facade" class="headerlink" title="外观模式(Façade)"></a>外观模式(Façade)</h1><p>在现代软件系统中，我们经常需要与复杂的子系统交互。这些子系统可能包含大量的类、复杂的API和繁琐的初始化流程。直接使用这些子系统会导致客户端代码变得复杂且难以维护。</p>
<p>外观模式(Facade)通过提供一个统一的高层接口，使得子系统更加容易使用。它隐藏了子系统的复杂性，为客户端提供了一个简单的入口点，同时不会限制那些需要直接访问子系统的高级用户。</p>
<h2 id="外观模式的典型结构"><a href="#外观模式的典型结构" class="headerlink" title="外观模式的典型结构"></a>外观模式的典型结构</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">┌─────────────────┐</span><br><span class="line">│     Client      │</span><br><span class="line">└────────┬────────┘</span><br><span class="line">         │ 使用</span><br><span class="line">         ↓</span><br><span class="line">┌─────────────────┐</span><br><span class="line">│     Facade      │ (外观类)</span><br><span class="line">├─────────────────┤</span><br><span class="line">│- subsystem1     │</span><br><span class="line">│- subsystem2     │</span><br><span class="line">│- subsystem3     │</span><br><span class="line">├─────────────────┤</span><br><span class="line">│+ operation1()   │ (简化的高层接口)</span><br><span class="line">│+ operation2()   │</span><br><span class="line">└────┬───┬───┬────┘</span><br><span class="line">     │   │   │ 委托调用</span><br><span class="line">     ↓   ↓   ↓</span><br><span class="line">┌────┴───┴───┴──────────────────────────────┐</span><br><span class="line">│          复杂子系统                       │</span><br><span class="line">│  ┌──────────┐  ┌──────────┐  ┌──────────┐ │</span><br><span class="line">│  │SubsystemA│  │SubsystemB│  │Subsystem │ │</span><br><span class="line">│  │          │  │          │  │    C       │</span><br><span class="line">│  │+ method()│  │+ method()│  │+ method()│ │</span><br><span class="line">│  └──────────┘  └──────────┘  └──────────┘ │</span><br><span class="line">│                                           │</span><br><span class="line">│  ┌──────────┐  ┌──────────┐               │</span><br><span class="line">│  │SubsystemD│  │SubsystemE│   ...         │</span><br><span class="line">│  │          │  │          │               │</span><br><span class="line">│  │+ method()│  │+ method()│               │</span><br><span class="line">│  └──────────┘  └──────────┘               │</span><br><span class="line">└───────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>角色</th>
<th>职责</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Facade</strong></td>
<td>外观类</td>
<td>提供简化的接口，将客户端请求委托给适当的子系统对象</td>
</tr>
<tr>
<td><strong>Subsystems</strong></td>
<td>子系统类</td>
<td>实现子系统功能，处理Facade对象分配的工作，但不知道Facade的存在</td>
</tr>
<tr>
<td><strong>Client</strong></td>
<td>客户端</td>
<td>通过Facade接口与子系统通信，无需直接访问子系统</td>
</tr>
</tbody></table>
<p>其工作流程大致如下：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">客户端调用 → Facade.operation()</span><br><span class="line">                    ↓</span><br><span class="line">            ┌───────┴───────┐</span><br><span class="line">            ↓               ↓</span><br><span class="line">    SubsystemA.method1() SubsystemB.method2()</span><br><span class="line">            ↓               ↓</span><br><span class="line">    SubsystemC.method3() SubsystemD.method4()</span><br><span class="line">            ↓               ↓</span><br><span class="line">            └───────┬───────┘</span><br><span class="line">                    ↓</span><br><span class="line">            返回统一结果给客户端</span><br></pre></td></tr></table></figure>

<p>外观模式的实现方式通常有以下几种：</p>
<ul>
<li>简单外观 提供对子系统的直接访问，仅仅是对现有接口的简单包装。</li>
<li>复杂外观 封装复杂的初始化流程和多步骤操作，可能包含状态管理和错误处理。</li>
<li>分层外观 为子系统的不同层次提供多个外观，形成外观的层次结构。</li>
</ul>
<h2 id="基础外观模式"><a href="#基础外观模式" class="headerlink" title="基础外观模式"></a>基础外观模式</h2><p>考虑一个家庭影院系统，它包含多个子系统：DVD播放器、投影仪、音响系统、灯光控制等。直接操作这些子系统需要执行一系列复杂的步骤：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子系统类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DVDPlayer</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;DVD Player on\n&quot;</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">off</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;DVD Player off\n&quot;</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">play</span><span class="params">(<span class="type">const</span> std::string&amp; movie)</span> </span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Playing movie: &quot;</span> &lt;&lt; movie &lt;&lt; <span class="string">&quot;\n&quot;</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Stopping DVD\n&quot;</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Projector</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Projector on\n&quot;</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">off</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Projector off\n&quot;</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">wideScreenMode</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Projector in widescreen mode\n&quot;</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SoundSystem</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Sound System on\n&quot;</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">off</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Sound System off\n&quot;</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setVolume</span><span class="params">(<span class="type">int</span> level)</span> </span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Sound System volume set to &quot;</span> &lt;&lt; level &lt;&lt; <span class="string">&quot;\n&quot;</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setSurroundSound</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Surround sound on\n&quot;</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Lights</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dim</span><span class="params">(<span class="type">int</span> level)</span> </span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Lights dimmed to &quot;</span> &lt;&lt; level &lt;&lt; <span class="string">&quot;%\n&quot;</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Lights on\n&quot;</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 外观类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HomeTheaterFacade</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    DVDPlayer&amp; dvd;</span><br><span class="line">    Projector&amp; projector;</span><br><span class="line">    SoundSystem&amp; soundSystem;</span><br><span class="line">    Lights&amp; lights;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">HomeTheaterFacade</span>(DVDPlayer&amp; dvd, Projector&amp; proj, </span><br><span class="line">                      SoundSystem&amp; sound, Lights&amp; lights)</span><br><span class="line">        : <span class="built_in">dvd</span>(dvd), <span class="built_in">projector</span>(proj), <span class="built_in">soundSystem</span>(sound), <span class="built_in">lights</span>(lights)</span><br><span class="line">    &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">watchMovie</span><span class="params">(<span class="type">const</span> std::string&amp; movie)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Get ready to watch a movie...\n&quot;</span>;</span><br><span class="line">        lights.<span class="built_in">dim</span>(<span class="number">10</span>);</span><br><span class="line">        projector.<span class="built_in">on</span>();</span><br><span class="line">        projector.<span class="built_in">wideScreenMode</span>();</span><br><span class="line">        soundSystem.<span class="built_in">on</span>();</span><br><span class="line">        soundSystem.<span class="built_in">setSurroundSound</span>();</span><br><span class="line">        soundSystem.<span class="built_in">setVolume</span>(<span class="number">5</span>);</span><br><span class="line">        dvd.<span class="built_in">on</span>();</span><br><span class="line">        dvd.<span class="built_in">play</span>(movie);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">endMovie</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Shutting down movie theater...\n&quot;</span>;</span><br><span class="line">        dvd.<span class="built_in">stop</span>();</span><br><span class="line">        dvd.<span class="built_in">off</span>();</span><br><span class="line">        soundSystem.<span class="built_in">off</span>();</span><br><span class="line">        projector.<span class="built_in">off</span>();</span><br><span class="line">        lights.<span class="built_in">on</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>使用外观模式后，客户端代码变得非常简洁：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">DVDPlayer dvd;</span><br><span class="line">Projector projector;</span><br><span class="line">SoundSystem soundSystem;</span><br><span class="line">Lights lights;</span><br><span class="line"></span><br><span class="line"><span class="function">HomeTheaterFacade <span class="title">homeTheater</span><span class="params">(dvd, projector, soundSystem, lights)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简单的接口调用</span></span><br><span class="line">homeTheater.<span class="built_in">watchMovie</span>(<span class="string">&quot;Inception&quot;</span>);</span><br><span class="line"><span class="comment">// Get ready to watch a movie...</span></span><br><span class="line"><span class="comment">// Lights dimmed to 10%</span></span><br><span class="line"><span class="comment">// Projector on</span></span><br><span class="line"><span class="comment">// Projector in widescreen mode</span></span><br><span class="line"><span class="comment">// Sound System on</span></span><br><span class="line"><span class="comment">// Surround sound on</span></span><br><span class="line"><span class="comment">// Sound System volume set to 5</span></span><br><span class="line"><span class="comment">// DVD Player on</span></span><br><span class="line"><span class="comment">// Playing movie: Inception</span></span><br><span class="line"></span><br><span class="line">homeTheater.<span class="built_in">endMovie</span>();</span><br><span class="line"><span class="comment">// Shutting down movie theater...</span></span><br><span class="line"><span class="comment">// Stopping DVD</span></span><br><span class="line"><span class="comment">// DVD Player off</span></span><br><span class="line"><span class="comment">// Sound System off</span></span><br><span class="line"><span class="comment">// Projector off</span></span><br><span class="line"><span class="comment">// Lights on</span></span><br></pre></td></tr></table></figure>

<h2 id="带状态管理的外观"><a href="#带状态管理的外观" class="headerlink" title="带状态管理的外观"></a>带状态管理的外观</h2><p>在实际应用中，外观类可能需要管理状态和处理错误。考虑一个数据库连接外观，它封装了连接池、事务管理和查询执行：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 子系统类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConnectionPool</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> maxConnections;</span><br><span class="line">    <span class="type">int</span> activeConnections = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">ConnectionPool</span><span class="params">(<span class="type">int</span> max)</span> : maxConnections(max) &#123;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">acquireConnection</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (activeConnections &lt; maxConnections)</span><br><span class="line">        &#123;</span><br><span class="line">            ++activeConnections;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Connection acquired. Active: &quot;</span> &lt;&lt; activeConnections &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">releaseConnection</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (activeConnections &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            --activeConnections;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Connection released. Active: &quot;</span> &lt;&lt; activeConnections &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getActiveConnections</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> activeConnections; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TransactionManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">bool</span> inTransaction = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">begin</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (inTransaction)</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Transaction already in progress&quot;</span>);</span><br><span class="line">        inTransaction = <span class="literal">true</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Transaction started\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">commit</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!inTransaction)</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;No active transaction&quot;</span>);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Transaction committed\n&quot;</span>;</span><br><span class="line">        inTransaction = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rollback</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!inTransaction)</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;No active transaction&quot;</span>);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Transaction rolled back\n&quot;</span>;</span><br><span class="line">        inTransaction = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isActive</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> inTransaction; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QueryExecutor</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">std::vector&lt;std::string&gt; <span class="title">execute</span><span class="params">(<span class="type">const</span> std::string&amp; query)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Executing query: &quot;</span> &lt;&lt; query &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="comment">// 模拟查询结果</span></span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;result1&quot;</span>, <span class="string">&quot;result2&quot;</span>, <span class="string">&quot;result3&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 外观类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DatabaseFacade</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    ConnectionPool connectionPool;</span><br><span class="line">    TransactionManager transactionManager;</span><br><span class="line">    QueryExecutor queryExecutor;</span><br><span class="line">    <span class="type">bool</span> connected = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">DatabaseFacade</span><span class="params">(<span class="type">int</span> maxConnections = <span class="number">10</span>)</span></span></span><br><span class="line"><span class="function">        : connectionPool(maxConnections)</span></span><br><span class="line"><span class="function">    &#123;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">connect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (connected)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Already connected\n&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (connectionPool.<span class="built_in">acquireConnection</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            connected = <span class="literal">true</span>;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Database connected\n&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Failed to connect: no available connections\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">disconnect</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!connected)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (transactionManager.<span class="built_in">isActive</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Rolling back active transaction before disconnect\n&quot;</span>;</span><br><span class="line">            transactionManager.<span class="built_in">rollback</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        connectionPool.<span class="built_in">releaseConnection</span>();</span><br><span class="line">        connected = <span class="literal">false</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Database disconnected\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::vector&lt;std::string&gt; <span class="title">executeQuery</span><span class="params">(<span class="type">const</span> std::string&amp; query)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!connected)</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Not connected to database&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> queryExecutor.<span class="built_in">execute</span>(query);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">executeTransaction</span><span class="params">(<span class="type">const</span> std::vector&lt;std::string&gt;&amp; queries)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!connected)</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Not connected to database&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            transactionManager.<span class="built_in">begin</span>();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; query : queries)</span><br><span class="line">            &#123;</span><br><span class="line">                queryExecutor.<span class="built_in">execute</span>(query);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            transactionManager.<span class="built_in">commit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Error during transaction: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            transactionManager.<span class="built_in">rollback</span>();</span><br><span class="line">            <span class="keyword">throw</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">DatabaseFacade</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (connected)</span><br><span class="line">            <span class="built_in">disconnect</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>使用示例：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">DatabaseFacade <span class="title">db</span><span class="params">(<span class="number">5</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简单查询</span></span><br><span class="line"><span class="keyword">if</span> (db.<span class="built_in">connect</span>())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">auto</span> results = db.<span class="built_in">executeQuery</span>(<span class="string">&quot;SELECT * FROM users&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; result : results)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; result &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Connection acquired. Active: 1</span></span><br><span class="line"><span class="comment">// Database connected</span></span><br><span class="line"><span class="comment">// Executing query: SELECT * FROM users</span></span><br><span class="line"><span class="comment">// Result: result1</span></span><br><span class="line"><span class="comment">// Result: result2</span></span><br><span class="line"><span class="comment">// Result: result3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 事务操作</span></span><br><span class="line">std::vector&lt;std::string&gt; transactionQueries = &#123;</span><br><span class="line">    <span class="string">&quot;INSERT INTO users VALUES (1, &#x27;Alice&#x27;)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;UPDATE accounts SET balance = 1000 WHERE user_id = 1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;DELETE FROM temp_data WHERE id &lt; 100&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">db.<span class="built_in">executeTransaction</span>(transactionQueries);</span><br><span class="line"><span class="comment">// Transaction started</span></span><br><span class="line"><span class="comment">// Executing query: INSERT INTO users VALUES (1, &#x27;Alice&#x27;)</span></span><br><span class="line"><span class="comment">// Executing query: UPDATE accounts SET balance = 1000 WHERE user_id = 1</span></span><br><span class="line"><span class="comment">// Executing query: DELETE FROM temp_data WHERE id &lt; 100</span></span><br><span class="line"><span class="comment">// Transaction committed</span></span><br><span class="line"></span><br><span class="line">db.<span class="built_in">disconnect</span>();</span><br><span class="line"><span class="comment">// Database disconnected</span></span><br><span class="line"><span class="comment">// Connection released. Active: 0</span></span><br></pre></td></tr></table></figure>

<h2 id="模块化外观"><a href="#模块化外观" class="headerlink" title="模块化外观"></a>模块化外观</h2><p>对于需要支持不同后端实现的场景,可以使用模板来创建灵活的外观。考虑一个日志系统外观，它可以支持不同的日志后端：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 日志级别</span></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">LogLevel</span></span><br><span class="line">&#123;</span><br><span class="line">    DEBUG,</span><br><span class="line">    INFO,</span><br><span class="line">    WARNING,</span><br><span class="line">    ERROR</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不同的日志后端</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConsoleLogger</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">write</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileLogger</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::ofstream file;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">FileLogger</span><span class="params">(<span class="type">const</span> std::string&amp; filename)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        file.<span class="built_in">open</span>(filename, std::ios::app);</span><br><span class="line">        <span class="keyword">if</span> (!file.<span class="built_in">is_open</span>())</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Failed to open log file&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">write</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (file.<span class="built_in">is_open</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            file &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">            file.<span class="built_in">flush</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">FileLogger</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (file.<span class="built_in">is_open</span>())</span><br><span class="line">            file.<span class="built_in">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 格式化器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogFormatter</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> std::string <span class="title">format</span><span class="params">(LogLevel level, <span class="type">const</span> std::string&amp; message)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::ostringstream oss;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加时间戳</span></span><br><span class="line">        <span class="keyword">auto</span> now = std::chrono::system_clock::<span class="built_in">now</span>();</span><br><span class="line">        <span class="keyword">auto</span> time = std::chrono::system_clock::<span class="built_in">to_time_t</span>(now);</span><br><span class="line">        oss &lt;&lt; std::<span class="built_in">put_time</span>(std::<span class="built_in">localtime</span>(&amp;time), <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加日志级别</span></span><br><span class="line">        oss &lt;&lt; <span class="string">&quot; [&quot;</span> &lt;&lt; <span class="built_in">levelToString</span>(level) &lt;&lt; <span class="string">&quot;] &quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加消息</span></span><br><span class="line">        oss &lt;&lt; message;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> oss.<span class="built_in">str</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> std::string <span class="title">levelToString</span><span class="params">(LogLevel level)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (level)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> LogLevel::DEBUG:   <span class="keyword">return</span> <span class="string">&quot;DEBUG&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> LogLevel::INFO:    <span class="keyword">return</span> <span class="string">&quot;INFO&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> LogLevel::WARNING: <span class="keyword">return</span> <span class="string">&quot;WARNING&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> LogLevel::ERROR:   <span class="keyword">return</span> <span class="string">&quot;ERROR&quot;</span>;</span><br><span class="line">            <span class="keyword">default</span>:                <span class="keyword">return</span> <span class="string">&quot;UNKNOWN&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 过滤器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogFilter</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    LogLevel minLevel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">LogFilter</span><span class="params">(LogLevel level = LogLevel::DEBUG)</span></span></span><br><span class="line"><span class="function">        : minLevel(level)</span></span><br><span class="line"><span class="function">    &#123;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">shouldLog</span><span class="params">(LogLevel level)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> level &gt;= minLevel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setMinLevel</span><span class="params">(LogLevel level)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        minLevel = level;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模板化的日志外观</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Backend&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoggingFacade</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Backend backend;</span><br><span class="line">    LogFormatter formatter;</span><br><span class="line">    LogFilter filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function">    <span class="keyword">explicit</span> <span class="title">LoggingFacade</span><span class="params">(Args&amp;&amp;... args)</span></span></span><br><span class="line"><span class="function">        : backend(std::forward&lt;Args&gt;(args)...)</span></span><br><span class="line"><span class="function">        , filter(LogLevel::INFO)</span></span><br><span class="line"><span class="function">    &#123;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setLogLevel</span><span class="params">(LogLevel level)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        filter.<span class="built_in">setMinLevel</span>(level);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">debug</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">log</span>(LogLevel::DEBUG, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">info</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">log</span>(LogLevel::INFO, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">warning</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">log</span>(LogLevel::WARNING, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">error</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">log</span>(LogLevel::ERROR, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">debug</span><span class="params">(<span class="type">const</span> std::string&amp; format, Args&amp;&amp;... args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">log</span>(LogLevel::DEBUG, formatMessage(format, std::forward&lt;Args&gt;(args)...));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">info</span><span class="params">(<span class="type">const</span> std::string&amp; format, Args&amp;&amp;... args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">log</span>(LogLevel::INFO, formatMessage(format, std::forward&lt;Args&gt;(args)...));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">warning</span><span class="params">(<span class="type">const</span> std::string&amp; format, Args&amp;&amp;... args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">log</span>(LogLevel::WARNING, formatMessage(format, std::forward&lt;Args&gt;(args)...));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">error</span><span class="params">(<span class="type">const</span> std::string&amp; format, Args&amp;&amp;... args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">log</span>(LogLevel::ERROR, formatMessage(format, std::forward&lt;Args&gt;(args)...));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">log</span><span class="params">(LogLevel level, <span class="type">const</span> std::string&amp; message)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (filter.<span class="built_in">shouldLog</span>(level))</span><br><span class="line">        &#123;</span><br><span class="line">            std::string formattedMessage = formatter.format(level, message);</span><br><span class="line">            backend.<span class="built_in">write</span>(formattedMessage);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function">    std::string <span class="title">formatMessage</span><span class="params">(<span class="type">const</span> std::string&amp; format, Args&amp;&amp;... args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::ostringstream oss;</span><br><span class="line">        formatHelper(oss, format, std::forward&lt;Args&gt;(args)...);</span><br><span class="line">        <span class="keyword">return</span> oss.<span class="built_in">str</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">formatHelper</span><span class="params">(std::ostringstream&amp; oss, <span class="type">const</span> std::string&amp; format, </span></span></span><br><span class="line"><span class="params"><span class="function">                     T&amp;&amp; value, Args&amp;&amp;... args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">size_t</span> pos = format.<span class="built_in">find</span>(<span class="string">&quot;&#123;&#125;&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (pos != std::string::npos)</span><br><span class="line">        &#123;</span><br><span class="line">            oss &lt;&lt; format.<span class="built_in">substr</span>(<span class="number">0</span>, pos) &lt;&lt; value;</span><br><span class="line">            formatHelper(oss, format.<span class="built_in">substr</span>(pos + <span class="number">2</span>), std::forward&lt;Args&gt;(args)...);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            oss &lt;&lt; format;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">formatHelper</span><span class="params">(std::ostringstream&amp; oss, <span class="type">const</span> std::string&amp; format)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        oss &lt;&lt; format;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>使用示例：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用控制台日志</span></span><br><span class="line">LoggingFacade&lt;ConsoleLogger&gt; consoleLog;</span><br><span class="line">consoleLog.<span class="built_in">setLogLevel</span>(LogLevel::DEBUG);</span><br><span class="line"></span><br><span class="line">consoleLog.<span class="built_in">debug</span>(<span class="string">&quot;Application started&quot;</span>);</span><br><span class="line"><span class="comment">// 2024-01-15 10:30:45 [DEBUG] Application started</span></span><br><span class="line"></span><br><span class="line">consoleLog.<span class="built_in">info</span>(<span class="string">&quot;User &#123;&#125; logged in from IP &#123;&#125;&quot;</span>, <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;192.168.1.100&quot;</span>);</span><br><span class="line"><span class="comment">// 2024-01-15 10:30:46 [INFO] User Alice logged in from IP 192.168.1.100</span></span><br><span class="line"></span><br><span class="line">consoleLog.<span class="built_in">warning</span>(<span class="string">&quot;Memory usage at &#123;&#125;%&quot;</span>, <span class="number">85</span>);</span><br><span class="line"><span class="comment">// 2024-01-15 10:30:47 [WARNING] Memory usage at 85%</span></span><br><span class="line"></span><br><span class="line">consoleLog.<span class="built_in">error</span>(<span class="string">&quot;Failed to connect to database&quot;</span>);</span><br><span class="line"><span class="comment">// 2024-01-15 10:30:48 [ERROR] Failed to connect to database</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用文件日志</span></span><br><span class="line"><span class="function">LoggingFacade&lt;FileLogger&gt; <span class="title">fileLog</span><span class="params">(<span class="string">&quot;application.log&quot;</span>)</span></span>;</span><br><span class="line">fileLog.<span class="built_in">setLogLevel</span>(LogLevel::INFO);</span><br><span class="line"></span><br><span class="line">fileLog.<span class="built_in">debug</span>(<span class="string">&quot;This won&#x27;t be logged&quot;</span>);  <span class="comment">// 被过滤器过滤</span></span><br><span class="line">fileLog.<span class="built_in">info</span>(<span class="string">&quot;This will be logged to file&quot;</span>);</span><br><span class="line">fileLog.<span class="built_in">error</span>(<span class="string">&quot;Critical error occurred&quot;</span>);</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://xxtongc.github.io/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F(Fa%C3%A7ade)/" data-id="cmkrcm9v20003noul6teze7ww" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-设计模式/结构性设计模式/代理模式(Proxy)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F(Proxy)/" class="article-date">
  <time class="dt-published" datetime="2026-01-23T20:42:35.653Z" itemprop="datePublished">2026-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="代理模式-Proxy"><a href="#代理模式-Proxy" class="headerlink" title="代理模式(Proxy)"></a>代理模式(Proxy)</h1><p>之前学习装饰器模式的时候，学到了强化功能的不同方法。代理模式也类似，但其目标是正在提供某些内部强化功能的同时准确（或尽可能地）保留正在使用的API。</p>
<p>代理模式没有什么同治的模式，因为不同的人构建的不同类型的代理相当多，并且用于不同目的。这里介绍一些不同的代理对象。</p>
<h2 id="智能指针"><a href="#智能指针" class="headerlink" title="智能指针"></a>智能指针</h2><p>最典型的STL给予我们的例子就是智能指针。智能指针是一个包装类，它封装了原始指针并维护引用计数，同时还重载了部分运算符。但总的来说智能指针提供了原始指针所具有的接口，所以在原始指针出现的位置，都可以使用智能指针。</p>
<h2 id="属性代理"><a href="#属性代理" class="headerlink" title="属性代理"></a>属性代理</h2><p>属性代理需要详细地介绍一下，这在游戏引擎中是常用技巧。</p>
<p>在其他语言中我们常常用 “属性” 表示底层成员与该成员的 getter&#x2F;setter 方法的组合。但是 C++ 中没有内置属性的支持，最常见的就是创建对于该成员的 get&#x2F;set 方法。但是这同时也意味着当我们要操作 t.foo 时，我们需要分别调用 t.get_foo() 和 t.set_foo(value)。但是当我们想继续使用 t.foo 的方法时，并为其提供特定的访问器 &#x2F; 修改器时，我们可以构建一个 <strong>属性代理</strong>。</p>
<p>属性代理说白了就是可以根据使用语义伪装为普通成员的类，如下定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Property</span></span><br><span class="line">&#123;</span><br><span class="line">    T value;</span><br><span class="line">    <span class="built_in">Property</span>(<span class="type">const</span> T initial_value)</span><br><span class="line">    &#123;</span><br><span class="line">        *<span class="keyword">this</span> = initial_value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">T</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    T <span class="keyword">operator</span>=(T new_value)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> value = new_value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>如此我们就可以如此使用这个属性代理：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Creature</span></span><br><span class="line">&#123;</span><br><span class="line">    Property&lt;<span class="type">int</span>&gt; strength&#123; <span class="number">10</span> &#125;;</span><br><span class="line">    Property&lt;<span class="type">int</span>&gt; agility&#123; <span class="number">5</span> &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Creature creature;</span><br><span class="line">creature.agility = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">auto</span> x = creature.strength;</span><br></pre></td></tr></table></figure>

<p>属性代理的一个可能扩展是引入伪强类型，可以使用property&lt;T, int Tag&gt;,以便3使用不同类型定义具有不同作用的值，例如，如果我们希望在相似的类型上支持某种算法，以便可以将两个强度值相加，但强度值和敏捷度不能相加，那么这种方法非常有用。</p>
<p>所以下面我们将介绍一下使用<strong>标签分发(Tag Dispatch)技术</strong>来创建**强类型别名(Strong Type Aliases)**，以避免类型混淆和逻辑错误伪强类型。</p>
<h3 id="问题背景：弱类型的困境"><a href="#问题背景：弱类型的困境" class="headerlink" title="问题背景：弱类型的困境"></a>问题背景：弱类型的困境</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 问题：所有属性都是 int，容易混淆</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Character</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> strength;     <span class="comment">// 力量</span></span><br><span class="line">    <span class="type">int</span> agility;      <span class="comment">// 敏捷</span></span><br><span class="line">    <span class="type">int</span> intelligence; <span class="comment">// 智力</span></span><br><span class="line">    <span class="type">int</span> health;       <span class="comment">// 生命值</span></span><br><span class="line">    <span class="type">int</span> mana;         <span class="comment">// 魔法值</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Character</span>(<span class="type">int</span> str, <span class="type">int</span> agi, <span class="type">int</span> intel, <span class="type">int</span> hp, <span class="type">int</span> mp)</span><br><span class="line">        : <span class="built_in">strength</span>(str), <span class="built_in">agility</span>(agi), <span class="built_in">intelligence</span>(intel)</span><br><span class="line">        , <span class="built_in">health</span>(hp), <span class="built_in">mana</span>(mp)</span><br><span class="line">    &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 这些操作在语法上都是合法的，但在逻辑上是错误的</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateProblem</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Character <span class="title">hero</span><span class="params">(<span class="number">10</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">100</span>, <span class="number">50</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 问题1：参数顺序错误，编译器无法检测</span></span><br><span class="line">    <span class="function">Character <span class="title">villain</span><span class="params">(<span class="number">100</span>, <span class="number">50</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">8</span>)</span></span>;  <span class="comment">// 参数顺序错了！</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 问题2：不同语义的值可以相加</span></span><br><span class="line">    <span class="type">int</span> total = hero.strength + hero.agility;  <span class="comment">// 力量+敏捷？这没意义！</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 问题3：可以将力量值赋给生命值</span></span><br><span class="line">    hero.health = hero.strength;  <span class="comment">// 类型相同，但语义不同</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 问题4：函数参数容易传错</span></span><br><span class="line">    <span class="keyword">auto</span> improveStats = [](<span class="type">int</span>&amp; str, <span class="type">int</span>&amp; agi) &#123;</span><br><span class="line">        str += <span class="number">5</span>;</span><br><span class="line">        agi += <span class="number">3</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 不小心传反了，编译器不会报错</span></span><br><span class="line">    <span class="built_in">improveStats</span>(hero.agility, hero.strength);  <span class="comment">// ❌ 参数顺序错了</span></span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;All operations compiled successfully, but logic is wrong!\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="解决方法：使用标签创建强类型"><a href="#解决方法：使用标签创建强类型" class="headerlink" title="解决方法：使用标签创建强类型"></a>解决方法：使用标签创建强类型</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ============ 标签定义 ============</span></span><br><span class="line"><span class="comment">// 用于区分不同语义的类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">StrengthTag</span> &#123;&#125;;      <span class="comment">// 力量标签</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AgilityTag</span> &#123;&#125;;       <span class="comment">// 敏捷标签</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">IntelligenceTag</span> &#123;&#125;;  <span class="comment">// 智力标签</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HealthTag</span> &#123;&#125;;        <span class="comment">// 生命值标签</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ManaTag</span> &#123;&#125;;          <span class="comment">// 魔法值标签</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ============ 强类型属性模板 ============</span></span><br><span class="line"><span class="comment">// T: 底层类型（如 int, double）</span></span><br><span class="line"><span class="comment">// Tag: 标签类型，用于区分不同的语义</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> Tag&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StrongProperty</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T value;</span><br><span class="line">    std::string name;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 构造函数</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">StrongProperty</span><span class="params">(<span class="type">const</span> std::string&amp; propName = <span class="string">&quot;unnamed&quot;</span>, </span></span></span><br><span class="line"><span class="params"><span class="function">                           <span class="type">const</span> T&amp; initialValue = T())</span></span></span><br><span class="line"><span class="function">        : value(initialValue), name(propName)</span></span><br><span class="line"><span class="function">    &#123;</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;StrongProperty&lt;&quot;</span> &lt;&lt; <span class="built_in">typeid</span>(Tag).<span class="built_in">name</span>() &lt;&lt; <span class="string">&quot;&gt; &#x27;&quot;</span> </span><br><span class="line">                  &lt;&lt; name &lt;&lt; <span class="string">&quot;&#x27; = &quot;</span> &lt;&lt; value &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 只能从相同标签类型赋值</span></span><br><span class="line">    StrongProperty&amp; <span class="keyword">operator</span>=(<span class="type">const</span> StrongProperty&lt;T, Tag&gt;&amp; other)</span><br><span class="line">    &#123;</span><br><span class="line">        value = other.value;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[ASSIGN] &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot; = &quot;</span> &lt;&lt; value &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ❌ 不能从不同标签类型赋值（编译错误）</span></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> OtherTag&gt;</span><br><span class="line">    StrongProperty&amp; <span class="keyword">operator</span>=(<span class="type">const</span> StrongProperty&lt;T, OtherTag&gt;&amp; other) = <span class="keyword">delete</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 可以从原始类型赋值</span></span><br><span class="line">    StrongProperty&amp; <span class="keyword">operator</span>=(<span class="type">const</span> T&amp; val)</span><br><span class="line">    &#123;</span><br><span class="line">        value = val;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[SET] &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot; = &quot;</span> &lt;&lt; value &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取值</span></span><br><span class="line">    <span class="function"><span class="type">const</span> T&amp; <span class="title">get</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型转换</span></span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">T</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 相同标签类型可以比较</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> StrongProperty&lt;T, Tag&gt;&amp; other) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> value == other.value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> StrongProperty&lt;T, Tag&gt;&amp; other) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> value &lt; other.value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&gt;(<span class="type">const</span> StrongProperty&lt;T, Tag&gt;&amp; other) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> value &gt; other.value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ❌ 不同标签类型不能比较（编译错误）</span></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> OtherTag&gt;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> StrongProperty&lt;T, OtherTag&gt;&amp; other) <span class="type">const</span> = <span class="keyword">delete</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> OtherTag&gt;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> StrongProperty&lt;T, OtherTag&gt;&amp; other) <span class="type">const</span> = <span class="keyword">delete</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 相同标签类型可以相加（返回新的强类型值）</span></span><br><span class="line">    StrongProperty&lt;T, Tag&gt; <span class="keyword">operator</span>+(<span class="type">const</span> StrongProperty&lt;T, Tag&gt;&amp; other) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">StrongProperty&lt;T, Tag&gt; <span class="title">result</span><span class="params">(name + <span class="string">&quot;+&quot;</span> + other.name, value + other.value)</span></span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[ADD] &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot;(&quot;</span> &lt;&lt; value &lt;&lt; <span class="string">&quot;) + &quot;</span> </span><br><span class="line">                  &lt;&lt; other.name &lt;&lt; <span class="string">&quot;(&quot;</span> &lt;&lt; other.value &lt;&lt; <span class="string">&quot;) = &quot;</span> </span><br><span class="line">                  &lt;&lt; result.value &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 可以加上原始类型</span></span><br><span class="line">    StrongProperty&lt;T, Tag&gt; <span class="keyword">operator</span>+(<span class="type">const</span> T&amp; val) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">StrongProperty</span>&lt;T, Tag&gt;(name, value + val);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ❌ 不同标签类型不能相加（编译错误）</span></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> OtherTag&gt;</span><br><span class="line">    StrongProperty&lt;T, Tag&gt; <span class="keyword">operator</span>+(<span class="type">const</span> StrongProperty&lt;T, OtherTag&gt;&amp; other) <span class="type">const</span> = <span class="keyword">delete</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 自增/自减</span></span><br><span class="line">    StrongProperty&amp; <span class="keyword">operator</span>+=(<span class="type">const</span> StrongProperty&lt;T, Tag&gt;&amp; other)</span><br><span class="line">    &#123;</span><br><span class="line">        value += other.value;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[+=] &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot; now = &quot;</span> &lt;&lt; value &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    StrongProperty&amp; <span class="keyword">operator</span>+=(<span class="type">const</span> T&amp; val)</span><br><span class="line">    &#123;</span><br><span class="line">        value += val;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[+=] &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot; now = &quot;</span> &lt;&lt; value &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    <span class="keyword">friend</span> std::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(std::ostream&amp; os, </span><br><span class="line">                                   <span class="type">const</span> StrongProperty&lt;T, Tag&gt;&amp; prop)</span><br><span class="line">    &#123;</span><br><span class="line">        os &lt;&lt; prop.value;</span><br><span class="line">        <span class="keyword">return</span> os;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ============ 类型别名定义 ============</span></span><br><span class="line"><span class="comment">// 为了方便使用，定义具体的类型别名</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> Strength = StrongProperty&lt;<span class="type">int</span>, StrengthTag&gt;;</span><br><span class="line"><span class="keyword">using</span> Agility = StrongProperty&lt;<span class="type">int</span>, AgilityTag&gt;;</span><br><span class="line"><span class="keyword">using</span> Intelligence = StrongProperty&lt;<span class="type">int</span>, IntelligenceTag&gt;;</span><br><span class="line"><span class="keyword">using</span> Health = StrongProperty&lt;<span class="type">int</span>, HealthTag&gt;;</span><br><span class="line"><span class="keyword">using</span> Mana = StrongProperty&lt;<span class="type">int</span>, ManaTag&gt;;</span><br></pre></td></tr></table></figure>

<h3 id="使用强类型属性"><a href="#使用强类型属性" class="headerlink" title="使用强类型属性"></a>使用强类型属性</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;strong_typed_property.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StrongCharacter</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Strength strength;</span><br><span class="line">    Agility agility;</span><br><span class="line">    Intelligence intelligence;</span><br><span class="line">    Health health;</span><br><span class="line">    Mana mana;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">StrongCharacter</span>(<span class="type">int</span> str, <span class="type">int</span> agi, <span class="type">int</span> intel, <span class="type">int</span> hp, <span class="type">int</span> mp)</span><br><span class="line">        : <span class="built_in">strength</span>(<span class="string">&quot;strength&quot;</span>, str)</span><br><span class="line">        , <span class="built_in">agility</span>(<span class="string">&quot;agility&quot;</span>, agi)</span><br><span class="line">        , <span class="built_in">intelligence</span>(<span class="string">&quot;intelligence&quot;</span>, intel)</span><br><span class="line">        , <span class="built_in">health</span>(<span class="string">&quot;health&quot;</span>, hp)</span><br><span class="line">        , <span class="built_in">mana</span>(<span class="string">&quot;mana&quot;</span>, mp)</span><br><span class="line">    &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 只接受力量类型的函数</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">increaseStrength</span><span class="params">(<span class="type">const</span> Strength&amp; bonus)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        strength += bonus;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 只接受敏捷类型的函数</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">increaseAgility</span><span class="params">(<span class="type">const</span> Agility&amp; bonus)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        agility += bonus;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printStats</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;\n=== Character Stats ===\n&quot;</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Strength: &quot;</span> &lt;&lt; strength &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Agility: &quot;</span> &lt;&lt; agility &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Intelligence: &quot;</span> &lt;&lt; intelligence &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Health: &quot;</span> &lt;&lt; health &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Mana: &quot;</span> &lt;&lt; mana &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;=== Creating Strong Typed Character ===\n&quot;</span>;</span><br><span class="line">    <span class="function">StrongCharacter <span class="title">hero</span><span class="params">(<span class="number">10</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">100</span>, <span class="number">50</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    hero.<span class="built_in">printStats</span>();</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\n=== Valid Operations ===\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 相同类型可以相加</span></span><br><span class="line">    <span class="function">Strength <span class="title">bonus1</span><span class="params">(<span class="string">&quot;bonus1&quot;</span>, <span class="number">5</span>)</span></span>;</span><br><span class="line">    <span class="function">Strength <span class="title">bonus2</span><span class="params">(<span class="string">&quot;bonus2&quot;</span>, <span class="number">3</span>)</span></span>;</span><br><span class="line">    Strength totalBonus = bonus1 + bonus2;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Total strength bonus: &quot;</span> &lt;&lt; totalBonus &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 可以增加相同类型的值</span></span><br><span class="line">    hero.strength += bonus1;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 相同类型可以比较</span></span><br><span class="line">    <span class="keyword">if</span> (hero.strength &gt; <span class="built_in">Strength</span>(<span class="string">&quot;threshold&quot;</span>, <span class="number">10</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Hero is strong!\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 可以赋值相同类型</span></span><br><span class="line">    <span class="function">Strength <span class="title">newStrength</span><span class="params">(<span class="string">&quot;newStrength&quot;</span>, <span class="number">20</span>)</span></span>;</span><br><span class="line">    hero.strength = newStrength;</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\n=== Invalid Operations (Compile Errors) ===\n&quot;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;The following would cause compile errors:\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ❌ 编译错误：不能将力量加到敏捷上</span></span><br><span class="line">    <span class="comment">// auto invalid1 = hero.strength + hero.agility;</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;// auto invalid1 = hero.strength + hero.agility;  // ❌ Compile Error\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ❌ 编译错误：不能将力量赋值给生命值</span></span><br><span class="line">    <span class="comment">// hero.health = hero.strength;</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;// hero.health = hero.strength;  // ❌ Compile Error\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ❌ 编译错误：不能比较力量和敏捷</span></span><br><span class="line">    <span class="comment">// if (hero.strength &gt; hero.agility) &#123;&#125;</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;// if (hero.strength &gt; hero.agility) &#123;&#125;  // ❌ Compile Error\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ❌ 编译错误：函数参数类型不匹配</span></span><br><span class="line">    <span class="comment">// hero.increaseStrength(hero.agility);</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;// hero.increaseStrength(hero.agility);  // ❌ Compile Error\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ❌ 编译错误：不能将敏捷加到力量上</span></span><br><span class="line">    <span class="comment">// hero.strength += hero.agility;</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;// hero.strength += hero.agility;  // ❌ Compile Error\</span></span><br><span class="line"><span class="string">    \n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    hero.<span class="built_in">printStats</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="支持特定操作的强类型"><a href="#支持特定操作的强类型" class="headerlink" title="支持特定操作的强类型"></a>支持特定操作的强类型</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ============ 特性标签 ============</span></span><br><span class="line"><span class="comment">// 用于控制哪些操作是允许的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Addable</span> &#123;&#125;;      <span class="comment">// 可加</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Subtractable</span> &#123;&#125;; <span class="comment">// 可减</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Multipliable</span> &#123;&#125;; <span class="comment">// 可乘</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Comparable</span> &#123;&#125;;   <span class="comment">// 可比较</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ============ 高级强类型属性 ============</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> Tag, <span class="keyword">typename</span>... Traits&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdvancedProperty</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T value;</span><br><span class="line">    std::string name;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查是否具有某个特性</span></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Trait&gt;</span></span><br><span class="line"><span class="function">    <span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">bool</span> <span class="title">hasTrait</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (std::is_same_v&lt;Trait, Traits&gt; || ...);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">AdvancedProperty</span><span class="params">(<span class="type">const</span> std::string&amp; propName = <span class="string">&quot;unnamed&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                             <span class="type">const</span> T&amp; initialValue = T())</span></span></span><br><span class="line"><span class="function">        : value(initialValue), name(propName)</span></span><br><span class="line"><span class="function">    &#123;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">const</span> T&amp; <span class="title">get</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">T</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">    </span><br><span class="line">    AdvancedProperty&amp; <span class="keyword">operator</span>=(<span class="type">const</span> T&amp; val)</span><br><span class="line">    &#123;</span><br><span class="line">        value = val;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 只有具有 Addable 特性才能相加</span></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U = <span class="type">void</span>&gt;</span><br><span class="line">    std::<span class="type">enable_if_t</span>&lt;<span class="built_in">hasTrait</span>&lt;Addable&gt;(), AdvancedProperty&gt;</span><br><span class="line">    <span class="keyword">operator</span>+(<span class="type">const</span> AdvancedProperty&amp; other) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[ADD] &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot;(&quot;</span> &lt;&lt; value &lt;&lt; <span class="string">&quot;) + &quot;</span> </span><br><span class="line">                  &lt;&lt; other.name &lt;&lt; <span class="string">&quot;(&quot;</span> &lt;&lt; other.value &lt;&lt; <span class="string">&quot;)\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">AdvancedProperty</span>(name + <span class="string">&quot;+&quot;</span> + other.name, value + other.value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U = <span class="type">void</span>&gt;</span><br><span class="line">    std::<span class="type">enable_if_t</span>&lt;<span class="built_in">hasTrait</span>&lt;Addable&gt;(), AdvancedProperty&amp;&gt;</span><br><span class="line">    <span class="keyword">operator</span>+=(<span class="type">const</span> AdvancedProperty&amp; other)</span><br><span class="line">    &#123;</span><br><span class="line">        value += other.value;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[+=] &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot; now = &quot;</span> &lt;&lt; value &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 只有具有 Subtractable 特性才能相减</span></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U = <span class="type">void</span>&gt;</span><br><span class="line">    std::<span class="type">enable_if_t</span>&lt;<span class="built_in">hasTrait</span>&lt;Subtractable&gt;(), AdvancedProperty&gt;</span><br><span class="line">    <span class="keyword">operator</span>-(<span class="type">const</span> AdvancedProperty&amp; other) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[SUB] &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot;(&quot;</span> &lt;&lt; value &lt;&lt; <span class="string">&quot;) - &quot;</span> </span><br><span class="line">                  &lt;&lt; other.name &lt;&lt; <span class="string">&quot;(&quot;</span> &lt;&lt; other.value &lt;&lt; <span class="string">&quot;)\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">AdvancedProperty</span>(name + <span class="string">&quot;-&quot;</span> + other.name, value - other.value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U = <span class="type">void</span>&gt;</span><br><span class="line">    std::<span class="type">enable_if_t</span>&lt;<span class="built_in">hasTrait</span>&lt;Subtractable&gt;(), AdvancedProperty&amp;&gt;</span><br><span class="line">    <span class="keyword">operator</span>-=(<span class="type">const</span> AdvancedProperty&amp; other)</span><br><span class="line">    &#123;</span><br><span class="line">        value -= other.value;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[-=] &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot; now = &quot;</span> &lt;&lt; value &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 只有具有 Multipliable 特性才能相乘</span></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U = <span class="type">void</span>&gt;</span><br><span class="line">    std::<span class="type">enable_if_t</span>&lt;<span class="built_in">hasTrait</span>&lt;Multipliable&gt;(), AdvancedProperty&gt;</span><br><span class="line">    <span class="keyword">operator</span>*(<span class="type">const</span> T&amp; scalar) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[MUL] &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot;(&quot;</span> &lt;&lt; value &lt;&lt; <span class="string">&quot;) * &quot;</span> &lt;&lt; scalar &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">AdvancedProperty</span>(name + <span class="string">&quot;*&quot;</span> + std::<span class="built_in">to_string</span>(scalar), </span><br><span class="line">                               value * scalar);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 只有具有 Comparable 特性才能比较</span></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U = <span class="type">void</span>&gt;</span><br><span class="line">    std::<span class="type">enable_if_t</span>&lt;<span class="built_in">hasTrait</span>&lt;Comparable&gt;(), <span class="type">bool</span>&gt;</span><br><span class="line">    <span class="keyword">operator</span>&gt;(<span class="type">const</span> AdvancedProperty&amp; other) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> value &gt; other.value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U = <span class="type">void</span>&gt;</span><br><span class="line">    std::<span class="type">enable_if_t</span>&lt;<span class="built_in">hasTrait</span>&lt;Comparable&gt;(), <span class="type">bool</span>&gt;</span><br><span class="line">    <span class="keyword">operator</span>&lt;(<span class="type">const</span> AdvancedProperty&amp; other) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> value &lt; other.value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U = <span class="type">void</span>&gt;</span><br><span class="line">    std::<span class="type">enable_if_t</span>&lt;<span class="built_in">hasTrait</span>&lt;Comparable&gt;(), <span class="type">bool</span>&gt;</span><br><span class="line">    <span class="keyword">operator</span>==(<span class="type">const</span> AdvancedProperty&amp; other) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> value == other.value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">friend</span> std::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(std::ostream&amp; os, </span><br><span class="line">                                   <span class="type">const</span> AdvancedProperty&amp; prop)</span><br><span class="line">    &#123;</span><br><span class="line">        os &lt;&lt; prop.value;</span><br><span class="line">        <span class="keyword">return</span> os;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ============ 具体类型定义 ============</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 力量：可加、可比较</span></span><br><span class="line"><span class="keyword">using</span> AdvStrength = AdvancedProperty&lt;<span class="type">int</span>, StrengthTag, Addable, Comparable&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 敏捷：可加、可比较</span></span><br><span class="line"><span class="keyword">using</span> AdvAgility = AdvancedProperty&lt;<span class="type">int</span>, AgilityTag, Addable, Comparable&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 伤害：可加、可减、可乘（伤害计算）、可比较</span></span><br><span class="line"><span class="keyword">using</span> Damage = AdvancedProperty&lt;<span class="type">int</span>, <span class="keyword">struct</span> DamageTag, </span><br><span class="line">                                Addable, Subtractable, Multipliable, Comparable&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 防御：可减（减少伤害）、可比较</span></span><br><span class="line"><span class="keyword">using</span> Defense = AdvancedProperty&lt;<span class="type">int</span>, <span class="keyword">struct</span> DefenseTag, </span><br><span class="line">                                 Subtractable, Comparable&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 经验值：只能加、可比较</span></span><br><span class="line"><span class="keyword">using</span> Experience = AdvancedProperty&lt;<span class="type">int</span>, <span class="keyword">struct</span> ExperienceTag, </span><br><span class="line">                                    Addable, Comparable&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ID：只能比较（不能进行算术运算）</span></span><br><span class="line"><span class="keyword">using</span> EntityID = AdvancedProperty&lt;<span class="type">int</span>, <span class="keyword">struct</span> EntityIDTag, Comparable&gt;;</span><br></pre></td></tr></table></figure>

<p>使用高级强类型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;advanced_strong_property.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameEntity</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    EntityID id;</span><br><span class="line">    AdvStrength strength;</span><br><span class="line">    AdvAgility agility;</span><br><span class="line">    Experience exp;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">GameEntity</span>(<span class="type">int</span> entityId, <span class="type">int</span> str, <span class="type">int</span> agi, <span class="type">int</span> experience)</span><br><span class="line">        : <span class="built_in">id</span>(<span class="string">&quot;id&quot;</span>, entityId)</span><br><span class="line">        , <span class="built_in">strength</span>(<span class="string">&quot;strength&quot;</span>, str)</span><br><span class="line">        , <span class="built_in">agility</span>(<span class="string">&quot;agility&quot;</span>, agi)</span><br><span class="line">        , <span class="built_in">exp</span>(<span class="string">&quot;exp&quot;</span>, experience)</span><br><span class="line">    &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CombatSystem</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 计算伤害</span></span><br><span class="line">    <span class="function"><span class="type">static</span> Damage <span class="title">calculateDamage</span><span class="params">(<span class="type">const</span> AdvStrength&amp; str, <span class="type">int</span> multiplier)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="function">Damage <span class="title">baseDamage</span><span class="params">(<span class="string">&quot;baseDamage&quot;</span>, str.get())</span></span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ✅ Damage 支持乘法</span></span><br><span class="line">        Damage finalDamage = baseDamage * multiplier;</span><br><span class="line">        </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Final damage: &quot;</span> &lt;&lt; finalDamage &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> finalDamage;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 应用防御</span></span><br><span class="line">    <span class="function"><span class="type">static</span> Damage <span class="title">applyDefense</span><span class="params">(<span class="type">const</span> Damage&amp; damage, <span class="type">const</span> Defense&amp; defense)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ✅ Damage 支持减法</span></span><br><span class="line">        <span class="function">Damage <span class="title">reducedDamage</span><span class="params">(<span class="string">&quot;reducedDamage&quot;</span>, damage.get())</span></span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 注意：这里需要手动计算，因为 Damage 和 Defense 是不同类型</span></span><br><span class="line">        <span class="type">int</span> finalValue = damage.<span class="built_in">get</span>() - defense.<span class="built_in">get</span>();</span><br><span class="line">        <span class="keyword">if</span> (finalValue &lt; <span class="number">0</span>) finalValue = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Damage after defense: &quot;</span> &lt;&lt; finalValue &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Damage</span>(<span class="string">&quot;finalDamage&quot;</span>, finalValue);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 增加经验</span></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">gainExperience</span><span class="params">(Experience&amp; currentExp, <span class="type">const</span> Experience&amp; gained)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ✅ Experience 支持加法</span></span><br><span class="line">        currentExp += gained;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;=== Creating Game Entities ===\n&quot;</span>;</span><br><span class="line">    <span class="function">GameEntity <span class="title">player</span><span class="params">(<span class="number">1001</span>, <span class="number">50</span>, <span class="number">30</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="function">GameEntity <span class="title">enemy</span><span class="params">(<span class="number">2001</span>, <span class="number">40</span>, <span class="number">25</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\n=== Valid Operations ===\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 力量可以相加</span></span><br><span class="line">    <span class="function">AdvStrength <span class="title">strengthBonus</span><span class="params">(<span class="string">&quot;bonus&quot;</span>, <span class="number">10</span>)</span></span>;</span><br><span class="line">    player.strength += strengthBonus;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 力量可以比较</span></span><br><span class="line">    <span class="keyword">if</span> (player.strength &gt; enemy.strength)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Player is stronger!\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 经验值可以增加</span></span><br><span class="line">    <span class="function">Experience <span class="title">expGained</span><span class="params">(<span class="string">&quot;expGained&quot;</span>, <span class="number">100</span>)</span></span>;</span><br><span class="line">    CombatSystem::<span class="built_in">gainExperience</span>(player.exp, expGained);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ ID 可以比较</span></span><br><span class="line">    <span class="keyword">if</span> (player.id == <span class="built_in">EntityID</span>(<span class="string">&quot;playerId&quot;</span>, <span class="number">1001</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Player ID matched!\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 伤害计算</span></span><br><span class="line">    Damage damage = CombatSystem::<span class="built_in">calculateDamage</span>(player.strength, <span class="number">2</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ 应用防御</span></span><br><span class="line">    <span class="function">Defense <span class="title">enemyDefense</span><span class="params">(<span class="string">&quot;enemyDefense&quot;</span>, <span class="number">30</span>)</span></span>;</span><br><span class="line">    Damage finalDamage = CombatSystem::<span class="built_in">applyDefense</span>(damage, enemyDefense);</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\n=== Invalid Operations (Would Cause Compile Errors) ===\n&quot;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;The following operations are not allowed:\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ❌ 力量不能相减（没有 Subtractable 特性）</span></span><br><span class="line">    <span class="comment">// auto invalid1 = player.strength - enemy.strength;</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;// auto invalid1 = player.strength - enemy.strength;  // ❌\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ❌ ID 不能相加（没有 Addable 特性）</span></span><br><span class="line">    <span class="comment">// auto invalid2 = player.id + enemy.id;</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;// auto invalid2 = player.id + enemy.id;  // ❌\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ❌ 经验值不能相减（没有 Subtractable 特性）</span></span><br><span class="line">    <span class="comment">// auto invalid3 = player.exp - expGained;</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;// auto invalid3 = player.exp - expGained;  // ❌\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ❌ 力量不能相乘（没有 Multipliable 特性）</span></span><br><span class="line">    <span class="comment">// auto invalid4 =  player.strength * 2;</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;// auto invalid4 = player.strength * 2;  // ❌\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ❌ 不同类型不能混合运算</span></span><br><span class="line">    <span class="comment">// auto invalid5 = player.strength + player.agility;</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;// auto invalid5 = player.strength + player.agility;  // ❌\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="虚拟代理"><a href="#虚拟代理" class="headerlink" title="虚拟代理"></a>虚拟代理</h2><p>虚拟代理的核心思想和单例模式中的懒汉模式类似，在需要使用到资源时再创建。这是为了在加载开销大的资源时能够延迟创建它。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">问题：某些对象创建成本很高</span><br><span class="line">┌─────────────────────────────────────────┐</span><br><span class="line">│ • 加载大文件（图片、视频、文档）         │</span><br><span class="line">│ • 建立数据库连接                         │</span><br><span class="line">│ • 初始化复杂的数据结构                   │</span><br><span class="line">│ • 网络资源获取                           │</span><br><span class="line">└─────────────────────────────────────────┘</span><br><span class="line">                    ↓</span><br><span class="line">解决方案：虚拟代理 = 占位符 + 延迟加载</span><br><span class="line">┌─────────────────────────────────────────┐</span><br><span class="line">│ <span class="number">1.</span> 创建轻量级代理对象（立即）            │</span><br><span class="line">│ <span class="number">2.</span> 只在真正需要时才创建真实对象          │</span><br><span class="line">│ <span class="number">3.</span> 对客户端透明                          │</span><br><span class="line">└─────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>假设我们有一个加载图片的需求：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Image</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">display</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    ~<span class="built_in">Image</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bitmap</span> : <span class="keyword">public</span> Image</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Bitmap</span>(<span class="type">const</span> std::string&amp; filename)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;loading image from&quot;</span> &lt;&lt; filename &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="comment">// loading image here</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// display image</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>那么当我们创建 Bitmap 时将直接触发加载图片的行为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Bitmap img&#123;<span class="string">&quot;picture.png&quot;</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>但我们想提前创建一个占位，当我们真正需要使用到这张图片的时候再加载它。</p>
<p>此时我们可以创建一个虚拟代理：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LazyBitmap</span> : <span class="keyword">public</span> image</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Bitmap* bmp&#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">    std::string filename;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">LazyBitmap</span>(<span class="type">const</span> std::string&amp; filename)</span><br><span class="line">        :<span class="built_in">filename</span>(filename)</span><br><span class="line">    &#123;&#125;</span><br><span class="line">    ~<span class="built_in">LazyBitmap</span>() &#123;<span class="keyword">delete</span> bmp;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!bmp)</span><br><span class="line">            bmp = <span class="keyword">new</span> <span class="built_in">Bitmap</span>(filename);</span><br><span class="line">        bmp-&gt;<span class="built_in">display</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>如上，我们就能在接口需要某个 image 时传入 LazyBitmap 以实现延迟加载了。</p>
<h2 id="通信代理"><a href="#通信代理" class="headerlink" title="通信代理"></a>通信代理</h2><p>通信代理很像装饰器模式，但其本质的特点在于装饰器模式操作的是在本地的对象，而通信代理操作的很可能是远程对象，其数据的获取需要通过网络通信：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌──────────────┬─────────────────────┬─────────────────────┐</span><br><span class="line">│              │      装饰器         │     通信代理        │</span><br><span class="line">├──────────────┼─────────────────────┼─────────────────────┤</span><br><span class="line">│ 对象位置     │ 本地（同一进程）     │ 远程（不同机器）    │</span><br><span class="line">├──────────────┼─────────────────────┼─────────────────────┤</span><br><span class="line">│ 调用方式     │ 直接方法调用        │ 网络/IPC通信         │</span><br><span class="line">├──────────────┼─────────────────────┼─────────────────────┤</span><br><span class="line">│ 主要目的     │ 增强功能            │ 隐藏远程性           │</span><br><span class="line">├──────────────┼─────────────────────┼─────────────────────┤</span><br><span class="line">│ 客户端感知   │ 知道是装饰          │ 不知道是远程         │</span><br><span class="line">├──────────────┼─────────────────────┼─────────────────────┤</span><br><span class="line">│ 性能开销     │ 几乎无              │ 网络延迟             │</span><br><span class="line">├──────────────┼─────────────────────┼─────────────────────┤</span><br><span class="line">│ 典型例子     │ 日志、缓存、压缩    │ RPC、Web服务         │</span><br><span class="line">└──────────────┴─────────────────────┴─────────────────────┘</span><br></pre></td></tr></table></figure>

<p>这里提供一个对比示例：</p>
<h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ============ 装饰器：本地文件操作 ============</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileWriter</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">write</span><span class="params">(<span class="type">const</span> std::string&amp; data)</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;写入文件: &quot;</span> &lt;&lt; data &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰器：添加压缩功能</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CompressedFileWriter</span> : <span class="keyword">public</span> FileWriter</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    FileWriter* writer;  <span class="comment">// 本地对象</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">CompressedFileWriter</span>(FileWriter* w) : <span class="built_in">writer</span>(w) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">write</span><span class="params">(<span class="type">const</span> std::string&amp; data)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[装饰] 压缩数据...\n&quot;</span>;</span><br><span class="line">        writer-&gt;<span class="built_in">write</span>(data);  <span class="comment">// 直接调用，本地操作</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ============ 通信代理：远程数据库 ============</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Database</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Database</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::string <span class="title">query</span><span class="params">(<span class="type">const</span> std::string&amp; sql)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 真实数据库在远程服务器上</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RemoteDatabase</span> : <span class="keyword">public</span> Database</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">std::string <span class="title">query</span><span class="params">(<span class="type">const</span> std::string&amp; sql)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;    [数据库服务器] 执行SQL: &quot;</span> &lt;&lt; sql &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;查询结果&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通信代理</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DatabaseProxy</span> : <span class="keyword">public</span> Database</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">std::string <span class="title">query</span><span class="params">(<span class="type">const</span> std::string&amp; sql)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;  [代理] 连接 db.server.com:3306\n&quot;</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;  [代理] 发送SQL查询...\n&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 实际通过网络调用远程数据库</span></span><br><span class="line">        RemoteDatabase remoteDB;</span><br><span class="line">        std::string result = remoteDB.<span class="built_in">query</span>(sql);</span><br><span class="line">        </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;  [代理] 接收结果\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;=== 实际应用对比 ===\n\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;【装饰器】本地文件写入:\n&quot;</span>;</span><br><span class="line">    FileWriter writer;</span><br><span class="line">    <span class="function">CompressedFileWriter <span class="title">compWriter</span><span class="params">(&amp;writer)</span></span>;</span><br><span class="line">    compWriter.<span class="built_in">write</span>(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;→ 文件和程序在同一台机器\n\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;【通信代理】远程数据库查询:\n&quot;</span>;</span><br><span class="line">    DatabaseProxy db;</span><br><span class="line">    std::string result = db.<span class="built_in">query</span>(<span class="string">&quot;SELECT * FROM users&quot;</span>);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;结果: &quot;</span> &lt;&lt; result &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;→ 数据库在另一台服务器上\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="值代理"><a href="#值代理" class="headerlink" title="值代理"></a>值代理</h2><h3 id="2-3-3-设计元素描述"><a href="#2-3-3-设计元素描述" class="headerlink" title="2.3.3 设计元素描述"></a>2.3.3 设计元素描述</h3><h4 id="1-表示层组件"><a href="#1-表示层组件" class="headerlink" title="1. 表示层组件"></a>1. 表示层组件</h4><p><strong>经济损失统计页面 (LossPage)</strong></p>
<ul>
<li>职责：展示火灾造成的经济损失统计数据</li>
<li>功能：<ul>
<li>显示直接经济损失和间接经济损失</li>
<li>按月度、季度、年度统计</li>
<li>损失对比分析</li>
<li>损失趋势图表</li>
<li>数据导出功能</li>
</ul>
</li>
<li>交互：调用经济损失服务</li>
</ul>
<p><strong>火灾原因分析页面 (ReasonPage)</strong></p>
<ul>
<li>职责：分析和展示火灾发生的原因统计</li>
<li>功能：<ul>
<li>显示各类原因的统计数据（存储电池、粉尘、电气等）</li>
<li>原因占比分析</li>
<li>原因趋势分析</li>
<li>饼图和柱状图展示</li>
</ul>
</li>
<li>交互：调用火灾原因服务</li>
</ul>
<p><strong>趋势预测页面 (TrendPage)</strong></p>
<ul>
<li>职责：基于历史数据进行趋势预测</li>
<li>功能：<ul>
<li>经济损失趋势预测</li>
<li>火灾发生频率预测</li>
<li>风险等级预测</li>
<li>预测结果可视化</li>
</ul>
</li>
<li>交互：调用趋势预测服务</li>
</ul>
<p><strong>报表生成页面 (ReportPage)</strong></p>
<ul>
<li>职责：生成和导出各类统计报表</li>
<li>功能：<ul>
<li>选择报表类型（日报、周报、月报、年报）</li>
<li>自定义报表时间范围</li>
<li>报表预览</li>
<li>导出为PDF、Excel、CSV格式</li>
</ul>
</li>
<li>交互：调用报表生成服务和数据导出服务</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://xxtongc.github.io/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F(Proxy)/" data-id="cmkrcm9v20002noulg8yc3oer" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-设计模式/结构性设计模式/享元模式(Flyweight)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F(Flyweight)/" class="article-date">
  <time class="dt-published" datetime="2026-01-23T20:42:35.650Z" itemprop="datePublished">2026-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="享元模式-Flyweight"><a href="#享元模式-Flyweight" class="headerlink" title="享元模式(Flyweight)"></a>享元模式(Flyweight)</h1><p>享元模式常常会用于有大量相似对象的场景下，我们会考虑如何将这些相似的对象储存起来的开销最小。</p>
<p>通常，我们会将享元模式下的对象分为<strong>可共享的内部状态</strong>和<strong>不可共享的外部状态</strong>。</p>
<h2 id="享元模式的典型结构"><a href="#享元模式的典型结构" class="headerlink" title="享元模式的典型结构"></a>享元模式的典型结构</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">┌─────────────────┐</span><br><span class="line">│     Client      │ (客户端)</span><br><span class="line">└────────┬────────┘</span><br><span class="line">         │ 请求享元对象</span><br><span class="line">         │ 传递外部状态</span><br><span class="line">         ↓</span><br><span class="line">┌─────────────────────────┐</span><br><span class="line">│   FlyweightFactory      │ (享元工厂)</span><br><span class="line">├─────────────────────────┤</span><br><span class="line">│- flyweights: Map        │ (享元对象池)</span><br><span class="line">├─────────────────────────┤</span><br><span class="line">│+ getFlyweight(key)      │ (获取或创建享元)</span><br><span class="line">└──────────┬──────────────┘</span><br><span class="line">           │ 创建/管理</span><br><span class="line">           │ 返回共享对象</span><br><span class="line">           ↓</span><br><span class="line">┌──────────────────────┐</span><br><span class="line">│     Flyweight        │ (抽象享元)</span><br><span class="line">│   &lt;&lt;interface&gt;&gt;      │</span><br><span class="line">├──────────────────────┤</span><br><span class="line">│+ operation(extrinsic)│ (接受外部状态)</span><br><span class="line">└──────▲───────────────┘</span><br><span class="line">       │</span><br><span class="line">       │ 实现</span><br><span class="line">       ├─────────────────────────┐</span><br><span class="line">       │                         │</span><br><span class="line">┌──────┴──────────────┐  ┌───────┴────────────┐</span><br><span class="line">│ConcreteFlyweight    │  │UnsharedFlyweight   │</span><br><span class="line">├─────────────────────┤  ├────────────────────┤</span><br><span class="line">│- intrinsicState     │  │- allState          │ (不共享)</span><br><span class="line">├─────────────────────┤  ├────────────────────┤</span><br><span class="line">│+ operation(extrinsic)│  │+ operation(...)    │</span><br><span class="line">└─────────────────────┘  └────────────────────┘</span><br><span class="line">   (共享的享元对象)         (不需要共享的对象)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>角色</th>
<th>职责</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Flyweight</strong></td>
<td>抽象享元</td>
<td>声明接口，通过该接口享元可以接受并作用于外部状态</td>
</tr>
<tr>
<td><strong>ConcreteFlyweight</strong></td>
<td>具体享元</td>
<td>实现Flyweight接口，存储内部状态（可共享）</td>
</tr>
<tr>
<td><strong>UnsharedFlyweight</strong></td>
<td>非共享享元</td>
<td>不需要共享的Flyweight子类（可选）</td>
</tr>
<tr>
<td><strong>FlyweightFactory</strong></td>
<td>享元工厂</td>
<td>创建并管理享元对象，确保合理地共享</td>
</tr>
<tr>
<td><strong>Client</strong></td>
<td>客户端</td>
<td>维护外部状态，调用享元对象时传递外部状态</td>
</tr>
</tbody></table>
<p>其工作流程大致如下：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">客户端请求 → FlyweightFactory.getFlyweight(key)</span><br><span class="line">                    ↓</span><br><span class="line">            检查享元池中是否存在该key</span><br><span class="line">                    ↓</span><br><span class="line">        ┌───────────┴───────────┐</span><br><span class="line">        ↓                       ↓</span><br><span class="line">    存在：返回现有享元      不存在：创建新享元</span><br><span class="line">        │                       │</span><br><span class="line">        │                   添加到享元池</span><br><span class="line">        │                       │</span><br><span class="line">        └───────────┬───────────┘</span><br><span class="line">                    ↓</span><br><span class="line">        返回享元对象给客户端</span><br><span class="line">                    ↓</span><br><span class="line">    客户端调用 flyweight.operation(extrinsicState)</span><br><span class="line">                    ↓</span><br><span class="line">        享元使用内部状态 + 外部状态完成操作</span><br></pre></td></tr></table></figure>

<h2 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h2><p>在游戏引擎中，我们会运用到很多纹理内容例如树木和草地等，我们不可能每次在世界中生成一棵树就为这颗树导入一个相同的纹理。常用的做法是创建一个纹理池，若在池中找不到这个纹理再从储存中导入这个纹理并将其储存在纹理池中。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>思考我们有一个需求，需要将一个文本的部分小写字母改为大写输出，比较幼稚的做法是为每个字母做一个是否为大小写的映射：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::string targetText;</span><br><span class="line"><span class="type">bool</span>* if_caps;</span><br></pre></td></tr></table></figure>

<p>这种做法有什么缺点呢？</p>
<ol>
<li>浪费大量内存</li>
<li>扩展性差，如果我们还需要将字符进行斜体、加粗等功能呢？</li>
</ol>
<p>那此时我们又会想到：储存需要更改的范围并将需要更改的相同的属性定义在一个类中。</p>
<p>以下是其完整的实现：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BetterFormattedText</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">TextRange</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> start, end;</span><br><span class="line">        <span class="type">bool</span> capitalize&#123;<span class="literal">false</span>&#125;;</span><br><span class="line">        <span class="comment">// other option here, e.g bold, italic, etc.</span></span><br><span class="line">        <span class="comment">// determine our range covers a particular position</span></span><br><span class="line">        <span class="function"><span class="type">bool</span> <span class="title">covers</span><span class="params">(<span class="type">int</span> position)</span> <span class="type">const</span> </span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> position &gt;= start &amp;&amp; position &lt;= end;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">TextRange&amp; <span class="title">get_range</span><span class="params">(<span class="type">int</span> start,<span class="type">int</span> end)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        formatting.<span class="built_in">emplace_back</span>(TextRange&#123;start, end&#125;);</span><br><span class="line">        <span class="keyword">return</span> *formatting.<span class="built_in">rbegin</span>();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string plain_text;</span><br><span class="line">    std::vector&lt;TextRange&gt; formatting;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时，当我们需要用其享元数据输出我们的文本内容时可以这样做：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">friend</span> ostream&amp; <span class="keyword">operator</span>&lt;&lt;(ostream&amp; os, <span class="type">const</span> BetterFormattedText&amp; obj)</span><br><span class="line">&#123;</span><br><span class="line">    std::string s;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">size_t</span> i = <span class="number">0</span>;i &lt; obj.plain_text.<span class="built_in">length</span>();++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> c = obj.plain_text[i];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">const</span> <span class="keyword">auto</span>&amp; rng : obj.formatting)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(rng.<span class="built_in">covers</span>(i)&amp;&amp;rng.capitalize)</span><br><span class="line">                c.<span class="built_in">toupper</span>(c);</span><br><span class="line">            s += c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> os &lt;&lt; s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://xxtongc.github.io/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F(Flyweight)/" data-id="cmkrcm9v30004noulew9z4y74" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-设计模式/观察者模式(Observer)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F(Observer)/" class="article-date">
  <time class="dt-published" datetime="2026-01-23T20:42:35.644Z" itemprop="datePublished">2026-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="观察者模式-Observer"><a href="#观察者模式-Observer" class="headerlink" title="观察者模式(Observer)"></a>观察者模式(Observer)</h1><p>观察者模式的核心在于当被观察者的状态发生变化时，观察者需要获取状态变化的通知，所以被观察者需要维护一个观察者的集合并负责通知。</p>
<p>对于观察者，需要设计其通知方法，实现相关类的观察者需要继承这个基类，并实现其关于通知的纯虚函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Observer</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">field_changed</span><span class="params">(T&amp; source, <span class="type">const</span> std::string&amp; field_name)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>对于被观察者，其需要继承可被观察类的属性：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Observable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">notify</span><span class="params">(T&amp; source, <span class="type">const</span> std::string&amp; name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; obs : observers)</span><br><span class="line">        &#123;</span><br><span class="line">            obs-&gt;<span class="built_in">field_changed</span>(source, name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">subscribe</span><span class="params">(Observer&lt;T&gt;* f)</span> </span>&#123;observers.<span class="built_in">emplace_back</span>(f);&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">unsubscribe</span><span class="params">(Observer&lt;T&gt;* f)</span></span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// 因为涉及到注销观察者，</span></span><br><span class="line">    <span class="comment">// 可以根据情况用不同的容器去维护观察者</span></span><br><span class="line">    std::vector&lt;Observer&lt;T&gt;*&gt; observers;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> : Observable&lt;Person&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">set_age</span><span class="params">(<span class="type">int</span> value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(age==value) <span class="keyword">return</span>;</span><br><span class="line">        age = value;</span><br><span class="line">        <span class="built_in">notify</span>(*<span class="keyword">this</span>,<span class="string">&quot;age&quot;</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PersonObserver</span> : Observer&lt;Person&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">field_changed</span><span class="params">(T&amp; source, <span class="type">const</span> std::string&amp; name)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(name==<span class="string">&quot;age&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            std::cout &lt;&lt; name &lt;&lt; <span class="string">&quot; changed into &quot;</span>&lt;&lt; source.<span class="built_in">get_age</span>() &lt;&lt; <span class="string">&quot;.\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时当我们调用了 set_age() 后，函数调用如下：</p>
<p>set_age() -&gt; notify() -&gt; field_changed()</p>
<p>其一种视图的设计方法是使用装饰器模式，要使用视图，可以使用普通属性（甚至是公共访问域），使对象保持简单且没有任何额外的行为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Observable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使用了Boost.Signals2库</span></span><br><span class="line">    signal&lt;<span class="built_in">void</span>(T&amp;,<span class="type">const</span> std::string&amp;)&gt; property_changed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    std::string name;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PersonView</span> : Obervable&lt;Person&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">PersonView</span><span class="params">(<span class="type">const</span> Person&amp; person)</span></span></span><br><span class="line"><span class="function">        :person&#123;</span>person&#125;</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">std::string&amp; <span class="title">get_name</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> person.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">set_name</span><span class="params">(<span class="type">const</span> std::string&amp; value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(value==person.name) <span class="keyword">return</span>;</span><br><span class="line">        person.name = value;</span><br><span class="line">        <span class="built_in">property_changed</span>(person,<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Person&amp; person;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://xxtongc.github.io/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F(Observer)/" data-id="cmkrcm9v10001noulhnsf9a19" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-设计模式/单例模式(Singleton)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F(Singleton)/" class="article-date">
  <time class="dt-published" datetime="2026-01-23T20:42:35.642Z" itemprop="datePublished">2026-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="单例模式-Singleton"><a href="#单例模式-Singleton" class="headerlink" title="单例模式(Singleton)"></a>单例模式(Singleton)</h1><p>单例模式因为在测试方面存在一些问题，所以并没有很广泛地运用。此文更多介绍其可能会出现的问题，对于其实现方式这里只贴出相关代码。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SingletonClass</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> SingletonClass <span class="title">get_Instance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">static</span> SingletonClass instance;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">SingletonClass</span>(singletonClass&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    <span class="built_in">SingletonClass</span>(singletonClass&amp;&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    SingletonClass <span class="keyword">operator</span>=(singletonClass&amp;)= <span class="keyword">delete</span>;</span><br><span class="line">    SingletonClass <span class="keyword">operator</span>=(singletonClass&amp;&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>: <span class="comment">// or private</span></span><br><span class="line">    <span class="built_in">SingletonClass</span>()</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="双重校验实现"><a href="#双重校验实现" class="headerlink" title="双重校验实现"></a>双重校验实现</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SingletonClass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">static</span> SingletonClass&amp; <span class="title">get_Instance</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="title">std::atomic</span><span class="params">(SingletonClass*)</span> m_instance</span>;</span><br><span class="line">    <span class="type">static</span> std::mutex mtx;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">SingletonClass&amp; <span class="title">SingletonClass::get_Instance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    SingletonClass *ins = m_instance.<span class="built_in">load</span>(std::memory_order_consume);</span><br><span class="line">    <span class="keyword">if</span>(!ins)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;</span><br><span class="line">        ins = m_instance.<span class="built_in">load</span>(std::memory_order_consume);</span><br><span class="line">        <span class="keyword">if</span>(!ins)</span><br><span class="line">        &#123;</span><br><span class="line">            ins = <span class="keyword">new</span> <span class="built_in">SingletonClass</span>();</span><br><span class="line">            m_instance.<span class="built_in">store</span>(ins,std::memory_order_release);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="C-20使用-call-once-实现"><a href="#C-20使用-call-once-实现" class="headerlink" title="C++20使用 call_once 实现"></a>C++20使用 call_once 实现</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SingletonClass</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">static</span> std::once_flag m_flag;</span><br><span class="line">    <span class="function"><span class="type">static</span> SingletonClass&amp; <span class="title">get_Instance</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// remember to delete </span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">initInstance</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="type">static</span> std::unique_ptr&lt;SingletonClass&gt; m_instance = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SingletonClass::initInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_instance = std::<span class="built_in">make_unique</span>&lt;SingletonClass&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">SingletonClass&amp; <span class="title">SingletonClass::get_Instance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::<span class="built_in">call_once</span>(m_flag, &amp;SingletonClass::initInstance);</span><br><span class="line">    <span class="keyword">return</span> *m_instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="单例模式存在的问题"><a href="#单例模式存在的问题" class="headerlink" title="单例模式存在的问题"></a>单例模式存在的问题</h2><p>假设有如下的单例模式设计：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Database</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">get_population</span><span class="params">(<span class="type">const</span> std::string&amp; name)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingletonDatabase</span> : <span class="keyword">public</span> Database</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">SingletonDatabase</span>()&#123;<span class="comment">/* read data from database */</span>&#125;</span><br><span class="line">    std::map&lt;std::string,<span class="type">int</span>&gt; capitals_population;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SingletonDatabse</span>(<span class="type">const</span> SingletonDatabase&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    SingletonDatabase <span class="keyword">operator</span>=(<span class="type">const</span> SingletonDatabase&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> SingletonDatabase&amp; <span class="title">get</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">static</span> SingletonDatabase db;</span><br><span class="line">        <span class="keyword">return</span> db;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get_population</span><span class="params">(<span class="type">const</span> std::string&amp; name)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> capitals_popution[name];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在如上实现中，我们通过将数据库中的 首都：人口 数据读入我们的 map 成员中保存，并通过接口 get_population 来获取对应首都人口数量。当我们需要一个组件获取总人口时：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SingletonRecordFinder</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">total_population</span><span class="params">(std::vector&lt;std::string&gt; capitals)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; capital:capitals)</span><br><span class="line">        &#123;</span><br><span class="line">            result += SingletonDatabase::<span class="built_in">get</span>().<span class="built_in">get_population</span>(capital);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>但当我们的测试人员需要对 SingletonRecordFinder 接口进行测试时，又因为其完全依赖于 SingletonDatabase，如果想检查新组件就会编写如下测试：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">TEST</span>(RecordFinderTests, SingletonTotalPopulationTest)</span><br><span class="line">&#123;</span><br><span class="line">    SingletonRecordFinder rf;</span><br><span class="line">    std::vector&lt;std::string&gt; names&#123;<span class="string">&quot;Seoul&quot;</span>, <span class="string">&quot;Mexico City&quot;</span>&#125;;</span><br><span class="line">    <span class="type">int</span> tp = rf.<span class="built_in">total_population</span>(names);</span><br><span class="line">    <span class="built_in">EXPECT_EQ</span>(<span class="number">17500000</span><span class="number">+17400000</span>, tp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这很糟糕，因为我们只想测试 SingletonRecordFinder 组件，但这下我们必须把整个数据库实例读取进内存参与测试，如果我们的目的是测试两者之间是否能够正常运行的集成测试，拿到也说得过去，但是当我们需要的是单元测试时，这就将十分糟糕。</p>
<p>解决方法之一就是设计这个组件的时候需要保存其source来源，而不是直接读取，如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ConfigurableRecordFinder</span></span><br><span class="line">&#123;</span><br><span class="line">    Database&amp; db;</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">ConfigurableRecordFinder</span><span class="params">(Database&amp; db)</span></span></span><br><span class="line"><span class="function">        db</span>&#123;db&#125;</span><br><span class="line">    &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">total_population</span><span class="params">(std::vector&lt;std::string&gt; names)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; capital: names)</span><br><span class="line">        &#123;</span><br><span class="line">            result += db.<span class="built_in">get_population</span>(capital);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如此，单元测试时我们可以自行构建用于测试的 Database 虚拟实例，而不是使用我们的物理实例。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://xxtongc.github.io/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F(Singleton)/" data-id="cmkrcm9uy0000noul5ky07p6k" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/project/page/2/">2</a><a class="extend next" rel="next" href="/project/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/project/archives/2026/01/">January 2026</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F(Adapter)/">(no title)</a>
          </li>
        
          <li>
            <a href="/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F(Decorator)/">(no title)</a>
          </li>
        
          <li>
            <a href="/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/">(no title)</a>
          </li>
        
          <li>
            <a href="/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%EF%BC%9A%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E3%80%81%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F%E3%80%81%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E5%92%8C%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E5%AF%B9%E6%AF%94/">(no title)</a>
          </li>
        
          <li>
            <a href="/project/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E6%80%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2026 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/project/" class="mobile-nav-link">Home</a>
  
    <a href="/project/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/project/js/jquery-3.6.4.min.js"></script>



  
<script src="/project/fancybox/jquery.fancybox.min.js"></script>




<script src="/project/js/script.js"></script>





  </div>
</body>
</html>